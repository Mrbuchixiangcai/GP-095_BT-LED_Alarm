C51 COMPILER V9.00   KEY_MODE                                                              11/14/2018 17:46:02 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE KEY_MODE
OBJECT MODULE PLACED IN .\Objects\Key_Mode.obj
COMPILER INVOKED BY: D:\ProgramFiles\Keil_v5\C51\BIN\C51.EXE App_User\Source\Key_Mode.c OPTIMIZE(8,SPEED) BROWSE INCDIR(
                    -.\Device;.\App_User\Include) DEBUG OBJECTEXTEND PRINT(.\Listings\Key_Mode.lst) OBJECT(.\Objects\Key_Mode.obj)

line level    source

   1          /*******************/
   2          /*Í·ÎÄ¼þheader file*/
   3          /*******************/
   4          #include "app_main.h"
   5          
   6          /************************/
   7          /*ºê¶¨Òåmacro definition*/
   8          /************************/
   9          
  10          /*************************/
  11          /*ÀàÐÍ¶¨Òåbyte definition*/
  12          /*************************/
  13          FLAG_KEYSET_TypeDef  FlagKSet_TypeDef;//°´¼üµÄ¹¦ÄÜÉèÖÃ±êÖ¾
  14          TIME_TEMP_TypeDef    Time_Temp_TypeDef;//ÉèÖÃÊ±¼äÊ±²Å°ÑÉèÖÃµÄÊ±¼äÏÈ¸¶¸øÕâ¸ö£¬È»ºóÈ·ÈÏÁËÔÙ¸³Öµµ½gRTC_xx;
  15          
  16          /****************************/
  17          /*±êÖ¾Î»¶¨Òåflags definetion*/
  18          /****************************/
  19          
  20          /*****************************/
  21          /*±äÁ¿¶¨Òåvariable definition*/
  22          /*****************************/
  23          uint8_t  gbKeyPress;//°´¼ü°´ÏÂ
  24          uint8_t  gbKeyNone; //Ã»ÓÐ°´¼ü°´ÏÂ
  25          uint8_t  KeyValue;  //°´¼üÖµ
  26          uint8_t  KeyEvent;  //°´¼üÊÂ¼þ
  27          uint8_t  cntKeyLoop;//¼ÆÊý°´¼üÑ­»·£¬¶Ì°´£¬³¤°´£¬³¬³¤°´µÄ°´ÏÂÊ±¼ä
  28          uint8_t  cntKeylong;
  29          uint8_t  KeyCurValueBK;//ÏÖÔÚ°´¼ü±¸·Ý
  30          uint8_t  KeyCurValue;//°´¼üÏÖÔÚÖµ
  31          uint8_t  KeyLastValue;//°´¼üÉÏÒ»´ÎµÄÖµ
  32          
  33          /**************************/
  34          /*Êý×é¶¨Òåarray definition*/
  35          /**************************/
  36          
  37          /******************************/
  38          /*º¯ÊýÉùÃ÷Function declaration*/
  39          /******************************/
  40          
  41          /*****************************/
  42          /*º¯Êý¶¨Òåfunction definetion*/
  43          /*****************************/
  44          /*******************************************************************************
  45           * º¯ÊýÔ­ÐÍ£º
  46           * ÊäÈë²ÎÊý£º
  47           * Êä³ö²ÎÊý£º
  48           * º¯Êý¹¦ÄÜ£º
  49           * ·µ»ØÖµËµÃ÷£º
  50           * ´´½¨ÈÕÆÚ£º
  51           * ´´½¨ÈË£º
  52           * ÐÞ¸ÄÈÕÆÚ
  53           * ÐÞ¸ÄÈË£º
  54           * µÚN´ÎÐÞ¸Ä£º
C51 COMPILER V9.00   KEY_MODE                                                              11/14/2018 17:46:02 PAGE 2   

  55           * ÐÞ¸ÄÔ­Òò£º
  56           * ±¸×¢£º"P1=0x2F(0010_1111)"ÏÈ¸³Öµ¸øP1¿Ú£¬P15Îª1£¬P14Îª0£¬ÊäÈë¶Ë(P10-P13)Îª1£¬
  57           * È»ºóÔÙ¶ÁP1¿ÚµçÆ½(P1&0x0F)£¬²¢°Ñ¸ßËÄÎ»¶¼Çå0£¬¼ÙÈçÕâÊ±ºòP10±»°´ÏÂ£¬ÄÇ¶Áµ½µÄP1
  58           * ¿ÚµçÆ½Îª(P1&0x0f)Îª0x0E(0000_1110),È»ºóÓë0x0F(0000_1111)Òì»òµÃµ½0x01(0000_0001),
  59           * 
  60           *******************************************************************************/
  61          uint8_t  Matrix_Buttons(void)
  62          {
  63   1        uint8_t tmp1=0;       
  64   1        uint8_t tmp2=0;               
  65   1        if((P1&0x0F)!=0x0F)   
  66   1        {
  67   2         P1|=0X20;  
  68   2         P1|=0X20; 
  69   2         P1|=0X20; 
  70   2         P1|=0X20;
  71   2         tmp1=P1&0x0F;          
  72   2         P1&=~0X30; 
  73   2         P1|=0X10;  
  74   2         P1|=0X10; 
  75   2         P1|=0X10;    
  76   2         P1|=0X10; 
  77   2         tmp2=P1&0x0F;                  
  78   2        }
  79   1        P1&=~0X30;
  80   1        if((tmp1==0x0E)&&(tmp2==0x0F))
  81   1        {
  82   2              return 1; //K_SNOOZE_DIMMER
  83   2        }
  84   1        if((tmp1==0x0D)&&(tmp2==0x0F))
  85   1        {
  86   2              return 2; //K_VOLINC
  87   2        }
  88   1        if((tmp1==0x0B)&&(tmp2==0x0F))
  89   1        {
  90   2              return 3; //K_PLAY_PAUSE
  91   2        }
  92   1        if((tmp1==0x07)&&(tmp2==0x0F))
  93   1        {
  94   2              return 4; //K_NEXT
  95   2        }
  96   1        if((tmp1==0x0F)&&(tmp2==0x0E))
  97   1        {
  98   2              return 5; //K_ALARM
  99   2        }
 100   1        if((tmp1==0x0F)&&(tmp2==0x0D))
 101   1        {
 102   2              return 6; //K_VOLDEC
 103   2        }
 104   1        if((tmp1==0x0F)&&(tmp2==0x0B))
 105   1        {
 106   2              return 7; //K_BT
 107   2        }
 108   1        if((tmp1==0x0F)&&(tmp2==0x07))
 109   1        {
 110   2              return 8; //K_PREV
 111   2        }
 112   1        if((tmp1==0x0E)&&(tmp2==0x0E))
 113   1        {
 114   2              return 9; //K_AL_SNOOZE
 115   2        }
 116   1        if((tmp1==0x0D)&&(tmp2==0x0E))
C51 COMPILER V9.00   KEY_MODE                                                              11/14/2018 17:46:02 PAGE 3   

 117   1        {
 118   2              return 10; //K_AL_VOLINC
 119   2        }
 120   1        if((tmp1==0x0F)&&(tmp2==0x0C))
 121   1        {
 122   2              return 11; //K_AL_VOLDEC
 123   2        }
 124   1              return 0;   
 125   1      //      uint8_t  readData1=0;
 126   1      //      uint8_t  readData2=0;
 127   1      //      uint8_t  temp_ReakData1=0;
 128   1      //      uint8_t  temp_ReakData2=0;
 129   1      //      uint8_t  scanKeyValue;
 130   1      //      scanKeyValue=0;//Èç¹ûÃ»ÓÐ°´¼ü°´ÏÂ¾ÍÊÇ·µ»Ø0
 131   1      //       
 132   1      //      /*******************************************************************************
 133   1      //      *¹¦ÄÜ£º"P1=0x2F(0010_1111)"ÏÈ¸³Öµ¸øP1¿Ú£¬P15Îª1£¬P14Îª0£¬ÊäÈë¶Ë(P10-P13)Îª1£¬È»
 134   1      //      * ºóÔÙ¶ÁP1¿ÚµçÆ½(P1&0x0F)£¬²¢°Ñ¸ßËÄÎ»¶¼Çå0(P1&0x0F£¬¼ÙÈçÕâÊ±ºòP10±»°´ÏÂ£¬ÄÇ¶Áµ½
 135   1      //      * µÄP1¿ÚµçÆ½Îª0x0E(0000_1110),È»ºóÓë0x0F(0000_1111)Òì»òµÃµ½0x01(0000_0001),
 136   1      //      * readData1µÄ·¶Î§Îª1¡¢2¡¢4¡¢8£¬scanKeyValueµÄ·¶Î§Îª1~9,9ÊÇ×éºÏ¼ü¡£
 137   1      ////    *******************************************************************************/
 138   1      ////    P1=0x2F;                        
 139   1      ////    readData1=(P1&0x0F)^0x0F;
 140   1      //      if((P1&0x0F)!=0x0F)
 141   1      //      {
 142   1      //              readData1=P1;
 143   1      //              P1=0x2F;
 144   1      //              temp_ReakData1=(P1&0x2F)^0x0F;
 145   1      //              switch(temp_ReakData1)
 146   1      //              {
 147   1      //                      case 0x21:
 148   1      //                              scanKeyValue=1; //K_SNOOZE_DIMMER
 149   1      //                              break;
 150   1      //                      case 0x22:
 151   1      //                              scanKeyValue=2; //VOL+(Êµ¼ÊVOL-)
 152   1      //                              break;
 153   1      //                      case 0x24:
 154   1      //                              scanKeyValue=3; //K_PLAY_PAUSE
 155   1      //                              break;
 156   1      //                      case 0x28:
 157   1      //                              scanKeyValue=4; //NEXT
 158   1      //                              break;
 159   1      //                      default:
 160   1      //                              break;
 161   1      //              }
 162   1      //      }
 163   1      //      /*******************************************************************************
 164   1      //      *¹¦ÄÜ£º"P1=0x1F(0001_1111)"ÏÈ¸³Öµ¸øP1¿Ú£¬P15Îª0£¬P14Îª1£¬ÊäÈë¶Ë(P10-P13)Îª1£¬È»
 165   1      //      * ºóÔÙ¶ÁP1¿ÚµçÆ½(P1&0x0F)£¬²¢°Ñ¸ßËÄÎ»¶¼Çå0(P1&0x0F£¬¼ÙÈçÕâÊ±ºòP11±»°´ÏÂ£¬ÄÇ¶Áµ½
 166   1      //      * µÄP1¿ÚµçÆ½Îª0x0D(0000_1101),È»ºóÓë0x0F(0000_1111)Òì»òµÃµ½0x02(0000_0010),
 167   1      //      * readData2µÄ·¶Î§Îª1¡¢2¡¢4¡¢8£¬scanKeyValueµÄ·¶Î§Îª1~9£¬9ÊÇ×éºÏ¼ü¡£
 168   1      //      *******************************************************************************/
 169   1      ////    P1=0x1F;
 170   1      ////    readData2=(P1&0x0F)^0x0F;
 171   1      //      if((P1&0x0F)!=0x0F)
 172   1      //      {
 173   1      //              readData2=P1;
 174   1      //              P1=0x1F;
 175   1      //              temp_ReakData2=(P1&0x1F)^0x0F;
 176   1      //              switch(temp_ReakData2)
 177   1      //              {
 178   1      //                      case 0x11:
C51 COMPILER V9.00   KEY_MODE                                                              11/14/2018 17:46:02 PAGE 4   

 179   1      ////                            if (scanKeyValue == 1)//Îª1ËµÃ÷¸Õ²Åalarm¼ü±»°´ÏÂ£¬ÒòÎªÃ¿´Îµ÷ÓÃÕâ¸öº¯Êý¶¼»á³õÊ¼»¯
 180   1      ////                            {                                         //keyValue£¬ËùÒÔ²»»áÊÇÉÏ´Îµ÷ÓÃº¯ÊýÁôÏÂµÄÖµ
 181   1      ////                                    scanKeyValue = 9; //K_AL_SNOOZE//ALARM+SNOOZE
 182   1      ////                            }
 183   1      ////                            else if (scanKeyValue == 2)
 184   1      ////                                    scanKeyValue = 10;//K_AL_VOLINC,//ALARM+VOLINC
 185   1      ////                            else
 186   1      //                                      scanKeyValue=5; //ALARM
 187   1      //                              break;
 188   1      //                      case 0x12:
 189   1      //                              scanKeyValue=6; //VOL-
 190   1      //                              break;
 191   1      //                      case 0x14:
 192   1      //                              scanKeyValue=7; //BT
 193   1      //                              break;
 194   1      //                      case 0x18:
 195   1      //                              scanKeyValue=8; //PREV
 196   1      //                              break;
 197   1      //                      case 0x0C:
 198   1      //                              scanKeyValue = 11; //K_AL_VOLDEC,
 199   1      //                      default:
 200   1      //                              break;
 201   1      //              }
 202   1      //      }
 203   1      //      readData1=0;
 204   1      //      readData2=0;
 205   1      //      P1=0x0F;
 206   1      //      return scanKeyValue;
 207   1      }
 208          
 209          /*******************************************************************************
 210           * º¯ÊýÔ­ÐÍ£º
 211           * ÊäÈë²ÎÊý£º
 212           * Êä³ö²ÎÊý£º
 213           * º¯Êý¹¦ÄÜ£º
 214           * ·µ»ØÖµËµÃ÷£º
 215           * ´´½¨ÈÕÆÚ£º
 216           * ´´½¨ÈË£º
 217           * ÐÞ¸ÄÈÕÆÚ
 218           * ÐÞ¸ÄÈË£º
 219           * µÚN´ÎÐÞ¸Ä£º
 220           * ÐÞ¸ÄÔ­Òò£º
 221           * ±¸×¢£º
 222           *******************************************************************************/
 223          uint8_t GetKeyValue(void) 
 224          {
 225   1              uint8_t  keyNum;
 226   1              keyNum=Matrix_Buttons();
 227   1              return keyNum; //·µ»Ø°´¼ü
 228   1      }
 229          
 230          /*******************************************************************************
 231           * º¯ÊýÔ­ÐÍ£º
 232           * ÊäÈë²ÎÊý£º
 233           * Êä³ö²ÎÊý£º
 234           * º¯Êý¹¦ÄÜ£º
 235           * ·µ»ØÖµËµÃ÷£º
 236           * ´´½¨ÈÕÆÚ£º
 237           * ´´½¨ÈË£º
 238           * ÐÞ¸ÄÈÕÆÚ
 239           * ÐÞ¸ÄÈË£º
 240           * µÚN´ÎÐÞ¸Ä£º
C51 COMPILER V9.00   KEY_MODE                                                              11/14/2018 17:46:02 PAGE 5   

 241           * ÐÞ¸ÄÔ­Òò£º
 242           * ±¸×¢£º
 243           *******************************************************************************/
 244          void KeyEventPorc(uint8_t KeyTmp) //±»µ÷ÓÃÊ±½ÓÊÕµÄÊÇGetKeyValue()µÄ·µ»ØÖµ  Ò»°ã¹Ì¶¨£¬²»¸ü¸Ä
 245          {
 246   1              gbKeyPress=0;
 247   1              if(KeyCurValue!=KeyTmp) //Õâ¸öifÓï¾äÊÇÈ¥¶¶£¬»á±»Ö´ÐÐÁ½´Î£¬µÚÈý´Î½øÀ´Ê±Ö±½ÓÌø¹ý
 248   1              {//KeyTmpÎªÁÙÊ±Öµ£¬
 249   2                      if(KeyCurValueBK!=KeyTmp)
 250   2                              KeyCurValueBK=KeyTmp;
 251   2                      else //µÚ¶þ´Î½øÀ´Ê±Ö´ÐÐÕâÒ»Ìõ
 252   2                              KeyCurValue=KeyTmp; //
 253   2                      return;
 254   2              }
 255   1              if(KeyCurValue==KeyLastValue)
 256   1              {
 257   2                      if((KeyLastValue==0) || (cntKeyLoop==0))
 258   2                              return;
 259   2                      if(--cntKeyLoop==0) //Õâ¸öÔÚµÚ¶þ´Î½øKeyEventPorc()º¯Êý£¨µÚÒ»´Î½ø¡°if(KeyCurValue==KeyLastValue)¡±Ö®Ç°£©Ê
             -±±»ÏÂÃæ¸³ÖµÎª5
 260   2                      { //cntKeyLoopÎª5¾ÍÊÇ50msÊ±¼ä
 261   3                              KeyValue=KeyLastValue; //·À¶¶Ö®ºó°ÑÈ·¶¨µÄ°´¼ü¸³Öµ¸øKeyValue
 262   3                              if(gbKeyNone==0)
 263   3                                      gbKeyPress=1;
 264   3                              switch(KeyEvent)
 265   3                              {
 266   4                                      case 0:
 267   4                                              KeyEvent=1;
 268   4                                              KeyValue |= K_D;
 269   4                                              cntKeyLoop=cKEY_HOLD;
 270   4                                              break;
 271   4                                      case 1:
 272   4                                              KeyEvent=2;
 273   4                                              KeyValue |= K_H;
 274   4                                              cntKeyLoop=cKEY_RATE_VOL;
 275   4                                              break;
 276   4                                              case 2:
 277   4                                      case 3:
 278   4                                              KeyEvent=3;
 279   4                                              KeyValue |= K_R;
 280   4                                              cntKeyLoop=cKEY_RATE_VOL;
 281   4                                              if(cntKeylong<250)
 282   4                                                      cntKeylong++;
 283   4                                              break;
 284   4                              }
 285   3                      }
 286   2              }
 287   1              else
 288   1              {
 289   2                      if(KeyLastValue)
 290   2                      {
 291   3                              KeyValue=KeyLastValue;
 292   3                              if(gbKeyNone==0)
 293   3                                      gbKeyPress=1;
 294   3                              switch(KeyEvent)
 295   3                              {
 296   4                                      case 1:KeyValue |= K_U; break;
 297   4                                      case 2:KeyValue |= K_LU;break;
 298   4                                      case 3:KeyValue |= K_LU;break;
 299   4                              }
 300   3                              KeyEvent=0;
 301   3                      }
C51 COMPILER V9.00   KEY_MODE                                                              11/14/2018 17:46:02 PAGE 6   

 302   2                      else
 303   2                      {
 304   3                              gbKeyNone=0;
 305   3                              cntKeylong=0;
 306   3                      }
 307   2                      cntKeyLoop=cKEY_CLICK;
 308   2                      KeyLastValue=KeyCurValue;
 309   2              }
 310   1      }
 311          
 312          /*******************************************************************************
 313           * º¯ÊýÔ­ÐÍ£º
 314           * ÊäÈë²ÎÊý£º
 315           * Êä³ö²ÎÊý£º
 316           * º¯Êý¹¦ÄÜ£º
 317           * ·µ»ØÖµËµÃ÷£º
 318           * ´´½¨ÈÕÆÚ£º
 319           * ´´½¨ÈË£º
 320           * ÐÞ¸ÄÈÕÆÚ
 321           * ÐÞ¸ÄÈË£º
 322           * µÚN´ÎÐÞ¸Ä£º
 323           * ÐÞ¸ÄÔ­Òò£º
 324           * ±¸×¢£º
 325           *******************************************************************************/
 326          void KeyScan(void) //±»Ö÷º¯Êýµ÷ÓÃ
 327          {
 328   1              KeyEventPorc(GetKeyValue());
 329   1      }
 330           
 331           /*******************************************************************************
 332           * º¯ÊýÔ­ÐÍ£º
 333           * ÊäÈë²ÎÊý£º
 334           * Êä³ö²ÎÊý£º
 335           * º¯Êý¹¦ÄÜ£º
 336           * ·µ»ØÖµËµÃ÷£º
 337           * ´´½¨ÈÕÆÚ£º
 338           * ´´½¨ÈË£º
 339           * ÐÞ¸ÄÈÕÆÚ
 340           * ÐÞ¸ÄÈË£º
 341           * µÚN´ÎÐÞ¸Ä£º
 342           * ÐÞ¸ÄÔ­Òò£º
 343           * ±¸×¢£º2.¡¢³¤°´¡°TIME¡±¼ü2S£¬Ð¡Ê±×Ö·ûÉÁË¸£¬¶Ì°´¡°VOL-/PREV¡±¼ü£¬Ð¡Ê±µÝ¼õ£¬³¤°´
 344           * ¡°VOL-/PREV¡±¼ü£¬Ð¡Ê±¿ìËÙµÝ¼õ£»¶Ì°´¡°VOL+/NEXT¡±¼ü£¬Ð¡Ê±µÝÔö£¬³¤°´¡°VOL+/NEXT¡±¼ü£¬
 345           * Ð¡Ê±¿ìËÙµÝÔö¡£
 346           * 3¡¢¶Ì°´¡°TIME¡±¼ü£¬·Ö×Ö·ûÉÁË¸£¬¶Ì°´¡°VOL-/PREV¡±¼ü£¬·ÖÎ»ÊýµÝ¼õ£¬³¤°´¡°VOL-/PREV¡±¼ü£¬
 347           * ·ÖÎ»Êý¿ìËÙµÝ¼õ£»¶Ì°´¡°VOL+/NEXT¡±¼ü£¬·ÖÎ»ÊýµÝÔö£¬³¤°´¡°VOL+/NEXT¡±¼ü£¬·ÖÎ»Êý¿ìËÙµÝ
 348           * Ôö¡£
 349           * 4¡¢ÔÚ×ßÊ±Ä£Ê½ÏÂ£¬¶Ì°´¡°TIME/DIM¡±¼ü£¬µ÷ÕûÏÔÊ¾ÁÁ¶È£¬¿ÉÑ­»·µ÷Õû¸ß¡¢ÖÐ¡¢µÍÁÁ£¨Ä¬ÈÏ
 350           * Îª¸ßÁÁ£©
 351           *******************************************************************************/
 352          void KeyComMsg(void) 
 353          {
 354   1              if(gbKeyPress)
 355   1              { 
 356   2                      //Flag_data_bk=1;//Êý¾Ý¸Ä±äÊ±±¸·Ý
 357   2                      switch(KeyValue)
 358   2                      {
 359   3                              case KU(K_SNOOZE_DIMMER)://¶Ì°´
 360   3                              {//Alarm_Ring_Run
 361   4                                      if (Alarm1_TypeDef.Alarm_RingRun == ALARM_RING_RUN_ON)
 362   4                                      {
 363   5                                              Alarm1_TypeDef.Alarm_Snooze = ALARM_SNOOZE_ON;//½øÈëÌ°Ë¯Ä£Ê½£¬Îª9·ÖÖÓ
C51 COMPILER V9.00   KEY_MODE                                                              11/14/2018 17:46:02 PAGE 7   

 364   5                                      }
 365   4                                      else//Õý³£×ßÊ±Ä£Ê½ÏÂ£¬¶Ì°´SNOOZE¼ü£¬µ÷½ÚLEDÆ½ÁÁ¶È£¬¿ÉÑ­»·µ÷½Ú¸ß¡¢ÖÐ¡¢µÍÁÁ¶È(Ä¬ÈÏÎª¸ß)
 366   4                                      {
 367   5                                              LED_Brightness_TypeDef--;
 368   5                                              if (LED_Brightness_TypeDef == LED_TURN_OFF)//ÈýµµÑ­»·
 369   5                                                      LED_Brightness_TypeDef = LED_HIGH;
 370   5                                      }
 371   4                                      break;
 372   4                              }
 373   3                              case KH(K_SNOOZE_DIMMER)://³¤°´
 374   3                              {
 375   4                                      
 376   4                                      break;
 377   4                              }
 378   3                              case KU(K_VOLINC): //¶Ì°´//ÒôÁ¿¼Ó 
 379   3                              case KR(K_VOLINC): //³¤°´//ÒôÁ¿¼Ó
 380   3                              {
 381   4                                      //³¤°´¡°VOL+/NEXT¡±¼ü£¬Ð¡Ê±¿ìËÙµÝÔö¡£
 382   4                                      //³¤°´¡°VOL+/NEXT¡±¼ü£¬·ÖÖÓÎ»Êý¿ìËÙµÝÔö¡£
 383   4                                      if ((FlagKSet_TypeDef == FLAG_KEYSET_SETTIME_HOUR) && (PlayMode_TypeDef == PLAY_IN_TIME))
 384   4                                      {
 385   5                                              if (Time_Temp_TypeDef.temp_RTC_Hour < 12)
 386   5                                              {
 387   6                                                      Time_Temp_TypeDef.temp_RTC_Hour++;
 388   6                                              }
 389   5                                      }
 390   4                                      else if ((FlagKSet_TypeDef == FLAG_KEYSET_SETTIME_MINUTE) && (PlayMode_TypeDef == PLAY_IN_TIME))
 391   4                                      {
 392   5                                              if (Time_Temp_TypeDef.temp_RTC_Minute < 59)
 393   5                                              {
 394   6                                                      Time_Temp_TypeDef.temp_RTC_Minute++;
 395   6                                              }
 396   5                                              timeCnt_30Sec = 0;//¿ªÆôÁË²»¶¯×÷30s×Ô¶¯±£´æ£¬ÕâÀï¶¯×÷ÁË£¬ËùÒÔÖØÐÂÖÃ0
 397   5                                      }
 398   4                                      else if ((FlagKSet_TypeDef == FLAG_KEYSET_SHORT_ALARM_HOUR) && (Alarm1_TypeDef.Alarm_OnOff == ALARM_ON
             -))
 399   4                                      {
 400   5                                              if (Alarm1_TypeDef.tempHour < 12)
 401   5                                              {
 402   6                                                      Alarm1_TypeDef.tempHour++;
 403   6                                              }
 404   5                                      }
 405   4                                      else if ((FlagKSet_TypeDef == FLAG_KEYSET_SHORT_ALARM_MINUTE) && (Alarm1_TypeDef.Alarm_OnOff == ALARM_
             -ON))
 406   4                                      {
 407   5                                              if (Alarm1_TypeDef.tempMinute < 59)
 408   5                                              {
 409   6                                                      Alarm1_TypeDef.tempMinute++;
 410   6                                              }
 411   5                                      }
 412   4                                      else if ((FlagKSet_TypeDef == FLAG_KEYSET_SHORT_ALARM_ALWORKMODE) && (Alarm1_TypeDef.Alarm_OnOff == AL
             -ARM_ON))
 413   4                                      {
 414   5                                              if (Alarm1_TypeDef.Alarm_WorkMode == ALARM_BEEP)
 415   5                                              {
 416   6                                                      Alarm1_TypeDef.Alarm_WorkMode = ALARM_BT;
 417   6                                              }
 418   5                                              else
 419   5                                              {
 420   6                                                      Alarm1_TypeDef.Alarm_WorkMode = ALARM_BEEP;
 421   6                                              }
 422   5                                              timeCnt_30Sec = 0;//¿ªÆôÁË²»¶¯×÷30s×Ô¶¯±£´æ£¬ÕâÀï¶¯×÷ÁË£¬ËùÒÔÖØÐÂÖÃ0
C51 COMPILER V9.00   KEY_MODE                                                              11/14/2018 17:46:02 PAGE 8   

 423   5                                      }
 424   4                                      else//ÔÚÀ¶ÑÀ»òTF×´Ì¬ÏÂ£¬ÒôÁ¿¹¦ÄÜ
 425   4                                      {
 426   5                                              if (sysVolume < 15)
 427   5                                              {
 428   6                                                      sysVolume++;
 429   6                                              }
 430   5                                      }
 431   4      
 432   4                                      break;
 433   4                              }
 434   3                              case KU(K_PLAY_PAUSE): //¶Ì°´//¶Ì°´·ÖÖÓ×Ö·ûÉÁË¸£¬
 435   3                              {                                       
 436   4                                      if (Music_Mode_TypeDef > MUSIC_OFF)//ÔÚÀ¶ÑÀºÍTF¿¨Ä£Ê½
 437   4                                      {
 438   5                                              Ctrl_Com_TypeDef = CTRL_NEXT;
 439   5                                      }
 440   4                                      break;
 441   4                              }
 442   3                              case KR(K_PLAY_PAUSE): //¼ÆÊ±
 443   3                              {
 444   4                                      
 445   4                                      break;
 446   4                              }
 447   3                              case KU(K_NEXT): //¶Ì°´
 448   3                              case KR(K_NEXT): //³¤°´
 449   3                              {
 450   4                                      
 451   4                                      break;
 452   4                              }
 453   3                              case KU(K_ALARM): //¶Ì°´//ÄÖÖÓ
 454   3                              {
 455   4                                      /* ÉèÖÃRTCÊ±¼ä */
 456   4                                      if (FlagKSet_TypeDef == FLAG_KEYSET_SETTIME_HOUR)
 457   4                                      {
 458   5                                              //ÔÚ³¤°´ALARM¼üºÍSNOOZE¼ü½øÈëÉèÖÃÊ±¼äÄ£Ê½-Ð¡Ê±ÉèÖÃ£¬ÔÚ¶Ì°´ALARM¼üÉèÖÃ·ÖÖÓÊ±¼ä
 459   5                                              FlagKSet_TypeDef = FLAG_KEYSET_SETTIME_MINUTE;
 460   5                                              Time_Temp_TypeDef.Flag_Confirm_30Sec=2;//¶Ì°´ALARM¼üÈ·ÈÏÉèÖÃ»ò²»¶¯×÷30s×Ô¶¯±£´æ£¬(Îª1ÊÇÈ·
 461   5                                                                                                                         //ÈÏÄÖÖÓÉèÖÃ±êÖ¾Î»),Îª2ÊÇ30s¼ÆÊ±±êÖ¾Î»£¬
 462   5                                              timeCnt_30Sec = 0;//Ð£×¼£¬ÒÔ·ÀÒÔÇ°ÉèÖÃµÄÊ±¼ä»òÕßÆäËû¹¦ÄÜÊ¹ÓÃÊ±timeCnt_30SecÓÐ´óÓÚ0µÄÖµ
 463   5                                      }
 464   4                                      else if (FlagKSet_TypeDef == FLAG_KEYSET_SETTIME_MINUTE)
 465   4                                      {
 466   5                                              //ÔÚ³¤°´ALARM¼üºÍSNOOZE¼ü½øÈëÉèÖÃÊ±¼äÄ£Ê½-Ð¡Ê±ÉèÖÃ£¬ÔÚ¶Ì°´ALARM¼üÉèÖÃ·ÖÖÓÊ±¼ä
 467   5                                              //ÔÚ¶Ì°´ALRM¼üÈ·ÈÏÊ±¼äÉèÖÃ£¬»òÕßÔÚ½øÈë·ÖÖÓÉèÖÃÊ±¼äÖ®ºó²»¶¯×÷30s¼´×Ô¶¯±£´æ
 468   5                                              FlagKSet_TypeDef = FLAG_KEYSET_OFF;
 469   5                                              gRTC_Hour   = Time_Temp_TypeDef.temp_RTC_Hour;
 470   5                                              gRTC_Minute = Time_Temp_TypeDef.temp_RTC_Minute;
 471   5                                              //Time_Temp_TypeDef.Flag_Confirm_30Sec = 1;//¶Ì°´ALARM¼üÈ·ÈÏÉèÖÃ»ò²»¶¯×÷30s×Ô¶¯±£´æ£¬(Îª1ÊÇÈ·
 472   5                                                                                                                               //ÈÏÄÖÖÓÉèÖÃ±êÖ¾Î»),Îª2ÊÇ30s¼ÆÊ±±êÖ¾Î»£¬
 473   5                                      }
 474   4      
 475   4                                      /* ÉèÖÃÄÖÖÓÊ±¼ä */
 476   4                                      if ((PlayMode_TypeDef == PLAY_IN_TIME) && (FlagKSet_TypeDef == FLAG_KEYSET_OFF))
 477   4                                      {
 478   5                                              //Ö»ÓÐÔÚ×ßÊ±ºÍÃ»ÓÐÆäËûÉèÖÃÄ£Ê½ÏÂ(±ÈÈçÊ±¼äÉèÖÃ£¬ÒòÎª¶Ì°´ALARMÓÐÆäËû¹¦ÄÜ)£¬²Å»á½øÈë´Ëif¹¦ÄÜ
 479   5                                              //ÉèÖÃÄÔÖÐÊ±¼ä²¢¿ªÆôÄÖÖÓ
 480   5                                              FlagKSet_TypeDef = FLAG_KEYSET_SHORT_ALARM_HOUR;
 481   5                                              Alarm1_TypeDef.Alarm_OnOff = ALARM_ON;
 482   5                                              Alarm1_TypeDef.Flag_Confirm_30Sec = 2;//µÚ¶þ´Î¿ªÆôÄÖÖÓ£¬²¢ÇÒ²»ÐÞ¸ÄÄÔÖÐÊ±¼ä£¬²»¶¯×÷30s×Ô¶¯±£
 483   5                                                                                                                        //´æ£¬(Îª1ÊÇÈ·ÈÏÄÖÖÓÉèÖÃ±êÖ¾Î»)Îª2ÊÇ30s¼ÆÊ±±êÖ¾Î»£¬
 484   5                                      }
C51 COMPILER V9.00   KEY_MODE                                                              11/14/2018 17:46:02 PAGE 9   

 485   4                                      else if ((FlagKSet_TypeDef == FLAG_KEYSET_SHORT_ALARM_HOUR) && (Alarm1_TypeDef.Alarm_OnOff == ALARM_ON
             -))  
 486   4                                      {
 487   5                                              FlagKSet_TypeDef = FLAG_KEYSET_SHORT_ALARM_MINUTE;
 488   5                                              Alarm1_TypeDef.Flag_Confirm_30Sec = 0;//µÚ¶þ´Î¿ªÆôÄÖÖÓ£¬²¢ÇÒÐÞ¸ÄÄÔÖÐÊ±¼ä£¬°Ñ²»¶¯×÷×Ô¶¯±£´æ¹Ø±Õ
 489   5                                              //timeCnt_30Sec = 0;                                      //²¢Ð£×¼Ê±¼äÎª0
 490   5                                      }
 491   4                                      else if ((FlagKSet_TypeDef == FLAG_KEYSET_SHORT_ALARM_MINUTE) && (Alarm1_TypeDef.Alarm_OnOff == ALARM_
             -ON))
 492   4                                      {
 493   5                                              FlagKSet_TypeDef = FLAG_KEYSET_SHORT_ALARM_ALWORKMODE;
 494   5                                              Alarm1_TypeDef.Flag_Confirm_30Sec = 2;//¶Ì°´ALARM¼üÈ·ÈÏÉèÖÃ»ò²»¶¯×÷30s×Ô¶¯±£´æ£¬(Îª1
 495   5                                                                                                                        //ÊÇÈ·ÈÏÄÖÖÓÉèÖÃ±êÖ¾Î»)Îª2ÊÇ30s¼ÆÊ±±êÖ¾Î»£¬
 496   5                                              timeCnt_30Sec = 0;//Ð£×¼£¬ÒÔ·ÀÒÔÇ°ÉèÖÃµÄÊ±¼ä»òÕßÆäËû¹¦ÄÜÊ¹ÓÃÊ±timeCnt_30SecÓÐ´óÓÚ0µÄÖµ
 497   5                                      }
 498   4      
 499   4                                      break;
 500   4                              }
 501   3                              case KH(K_ALARM): //³¤°´//ÄÖÖÓ
 502   3                              {
 503   4                                      
 504   4                                      break;
 505   4                              }
 506   3                              case KU(K_VOLDEC): //¶Ì°´//ÒôÁ¿¼õ
 507   3                              case KR(K_VOLDEC): //³¤°´//ÒôÁ¿¼õ
 508   3                              {
 509   4                                      //³¤°´¡°VOL-/PREV¡±¼ü£¬Ð¡Ê±¿ìËÙµÝ¼õ£»
 510   4                                      //³¤°´¡°VOL-/PREV¡±¼ü£¬·ÖÖÓÎ»Êý¿ìËÙµÝ¼õ£»
 511   4                                      if ((FlagKSet_TypeDef == FLAG_KEYSET_SETTIME_HOUR) && (PlayMode_TypeDef == PLAY_IN_TIME))
 512   4                                      {
 513   5                                              if (Time_Temp_TypeDef.temp_RTC_Hour > 0)
 514   5                                              {
 515   6                                                      Time_Temp_TypeDef.temp_RTC_Hour--;
 516   6                                              }
 517   5                                      }
 518   4                                      else if ((FlagKSet_TypeDef == FLAG_KEYSET_SETTIME_MINUTE) && (PlayMode_TypeDef == PLAY_IN_TIME))
 519   4                                      {
 520   5                                              if (Time_Temp_TypeDef.temp_RTC_Minute > 0)
 521   5                                              {
 522   6                                                      Time_Temp_TypeDef.temp_RTC_Minute--;
 523   6                                              }
 524   5                                              timeCnt_30Sec = 0;//¿ªÆôÁË²»¶¯×÷30s×Ô¶¯±£´æ£¬ÕâÀï¶¯×÷ÁË£¬ËùÒÔÖØÐÂÖÃ0
 525   5                                      }
 526   4                                      else if ((FlagKSet_TypeDef == FLAG_KEYSET_SHORT_ALARM_HOUR) && (Alarm1_TypeDef.Alarm_OnOff == ALARM_ON
             -))
 527   4                                      {
 528   5                                              if (Alarm1_TypeDef.tempHour > 0)
 529   5                                              {
 530   6                                                      Alarm1_TypeDef.tempHour--;
 531   6                                              }
 532   5                                      }
 533   4                                      else if ((FlagKSet_TypeDef == FLAG_KEYSET_SHORT_ALARM_MINUTE) && (Alarm1_TypeDef.Alarm_OnOff == ALARM_
             -ON))
 534   4                                      {
 535   5                                              if (Alarm1_TypeDef.tempMinute > 0)
 536   5                                              {
 537   6                                                      Alarm1_TypeDef.tempMinute--;
 538   6                                              }
 539   5                                      }
 540   4                                      else if ((FlagKSet_TypeDef == FLAG_KEYSET_SHORT_ALARM_ALWORKMODE) && (Alarm1_TypeDef.Alarm_OnOff == AL
             -ARM_ON))
 541   4                                      {
C51 COMPILER V9.00   KEY_MODE                                                              11/14/2018 17:46:02 PAGE 10  

 542   5                                              if (Alarm1_TypeDef.Alarm_WorkMode == ALARM_BEEP)
 543   5                                              {
 544   6                                                      Alarm1_TypeDef.Alarm_WorkMode = ALARM_BT;
 545   6                                              }
 546   5                                              else
 547   5                                              {
 548   6                                                      Alarm1_TypeDef.Alarm_WorkMode = ALARM_BEEP;
 549   6                                              }
 550   5                                              timeCnt_30Sec = 0;//¿ªÆôÁË²»¶¯×÷30s×Ô¶¯±£´æ£¬ÕâÀï¶¯×÷ÁË£¬ËùÒÔÖØÐÂÖÃ0
 551   5                                      }
 552   4                                      else//ÔÚÀ¶ÑÀ»òTF×´Ì¬ÏÂ£¬ÒôÁ¿¹¦ÄÜ
 553   4                                      {
 554   5                                              if (sysVolume > 0)
 555   5                                              {
 556   6                                                      sysVolume--;
 557   6                                              }
 558   5                                      }
 559   4      
 560   4                                      break;
 561   4                              }
 562   3                              case KU(K_BT): //¶Ì°´
 563   3                              {
 564   4                                      //¶Ì°´¡°VOL-/PREV¡±¼ü£¬Ð¡Ê±µÝ¼õ£¬
 565   4                                      //¶Ì°´¡°VOL-/PREV¡±¼ü£¬·ÖÖÓÎ»ÊýµÝ¼õ£¬
 566   4                                      if (Music_Mode_TypeDef != MUSIC_BT)
 567   4                                      {
 568   5                                              Music_Mode_TypeDef = MUSIC_BT;
 569   5                                      }
 570   4                                      break;
 571   4                              }
 572   3                              case KH(K_BT): //³¤°´
 573   3                              {
 574   4                                      //³¤°´¡°VOL-/PREV¡±¼ü£¬Ð¡Ê±¿ìËÙµÝ¼õ£»
 575   4                                      //³¤°´¡°VOL-/PREV¡±¼ü£¬·ÖÖÓÎ»Êý¿ìËÙµÝ¼õ£»
 576   4                                      break;
 577   4                              }
 578   3                              case KU(K_PREV): //¶Ì°´
 579   3                              case KR(K_PREV): //³¤°´
 580   3                              {
 581   4                                      if (Music_Mode_TypeDef > MUSIC_OFF)//ÔÚÀ¶ÑÀºÍTF¿¨Ä£Ê½
 582   4                                      {
 583   5                                              Ctrl_Com_TypeDef = CTRL_PREV;
 584   5                                      }
 585   4                                      break;
 586   4                              }
 587   3                              case KU(K_AL_SNOOZE): //¶Ì°´
 588   3                              {
 589   4      
 590   4                                      break;
 591   4                              }
 592   3                              case KR(K_AL_SNOOZE): //³¤°´
 593   3                              {
 594   4                                      if (PlayMode_TypeDef == PLAY_IN_TIME)
 595   4                                      {
 596   5                                              if (cntKeylong == 10)//2s
 597   5                                              {
 598   6                                                      //³¤°´ALARMºÍSNOOZE¼ü2s½øÈëÊ±¼äÉèÖÃÄ£Ê½-Ð¡ÊÂÉèÖÃ
 599   6                                                      FlagKSet_TypeDef = FLAG_KEYSET_SETTIME_HOUR;
 600   6                                              }
 601   5                                      }
 602   4                                      break;
 603   4                              }
C51 COMPILER V9.00   KEY_MODE                                                              11/14/2018 17:46:02 PAGE 11  

 604   3                              case KU(K_AL_VOLINC): //¶Ì°´
 605   3                              case KR(K_AL_VOLINC): //³¤°´
 606   3                              {
 607   4                                      if (PlayMode_TypeDef == PLAY_IN_TIME)
 608   4                                      {
 609   5                                              if (cntKeylong == 10)//2s
 610   5                                                      gRTC_Hour = gRTC_Hour + 1;//×éºÏ¼ü-ÄÖÖÓºÍÒôÁ¿¼Ó-Í¬Ê±2s-RTCÊ±¼ä¼ÓÒ»Ð¡Ê±£¬±íÊ¾¿ªÆôÏÄÁîÊ±
 611   5                                      }
 612   4                                      break;
 613   4                              }
 614   3                              case KU(K_AL_VOLDEC): //¶Ì°´
 615   3                              case KR(K_AL_VOLDEC): //³¤°´
 616   3                              {
 617   4                                      if (PlayMode_TypeDef == PLAY_IN_TIME)
 618   4                                      {
 619   5                                              if (cntKeylong == 10)//2s
 620   5                                                      gRTC_Hour = gRTC_Hour - 1;//×éºÏ¼ü-ÄÖÖÓºÍÒôÁ¿¼õ-Í¬Ê±2s-RTCÊ±¼ä¼õÒ»Ð¡Ê±£¬±íÊ¾¹Ø±ÕÏÄÁîÊ±
 621   5                                      }
 622   4                                      break;
 623   4                              }
 624   3                      }
 625   2                      testINT=KeyValue;
 626   2              }
 627   1      }
 628          
 629          
 630          
 631          
 632           
 633           /*******************************************************************************
 634           * º¯ÊýÔ­ÐÍ£º
 635           * ÊäÈë²ÎÊý£º
 636           * Êä³ö²ÎÊý£º
 637           * º¯Êý¹¦ÄÜ£º
 638           * ·µ»ØÖµËµÃ÷£º
 639           * ´´½¨ÈÕÆÚ£º
 640           * ´´½¨ÈË£º
 641           * ÐÞ¸ÄÈÕÆÚ
 642           * ÐÞ¸ÄÈË£º
 643           * µÚN´ÎÐÞ¸Ä£º
 644           * ÐÞ¸ÄÔ­Òò£º
 645           * ±¸×¢£º
 646           *******************************************************************************/
 647           
 648           
 649           /*******************************************************************************
 650           * º¯ÊýÔ­ÐÍ£º
 651           * ÊäÈë²ÎÊý£º
 652           * Êä³ö²ÎÊý£º
 653           * º¯Êý¹¦ÄÜ£º
 654           * ·µ»ØÖµËµÃ÷£º
 655           * ´´½¨ÈÕÆÚ£º
 656           * ´´½¨ÈË£º
 657           * ÐÞ¸ÄÈÕÆÚ
 658           * ÐÞ¸ÄÈË£º
 659           * µÚN´ÎÐÞ¸Ä£º
 660           * ÐÞ¸ÄÔ­Òò£º
 661           * ±¸×¢£º
 662           *******************************************************************************/
 663          
 664          
 665          
C51 COMPILER V9.00   KEY_MODE                                                              11/14/2018 17:46:02 PAGE 12  

 666          
 667          
 668          
 669          
 670          
 671          
 672          
 673          
 674          
 675          
 676          
 677          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    873    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     14    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
