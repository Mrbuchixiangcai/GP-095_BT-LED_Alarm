C51 COMPILER V9.00   APP_MAIN                                                              11/24/2018 11:14:26 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE APP_MAIN
OBJECT MODULE PLACED IN .\Objects\app_main.obj
COMPILER INVOKED BY: D:\ProgramFiles\Keil_v5\C51\BIN\C51.EXE App_User\Source\app_main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(
                    -.\Device;.\App_User\Include) DEBUG OBJECTEXTEND PRINT(.\Listings\app_main.lst) OBJECT(.\Objects\app_main.obj)

line level    source

   1          /*******************/
   2          /*Í·ÎÄ¼þheader file*/
   3          /*******************/
   4          #include "app_main.h"
   5          
   6          /************************/
   7          /*ºê¶¨Òåmacro definition*/
   8          /************************/
   9          
  10          /*************************/
  11          /*ÀàÐÍ¶¨Òåbyte definition*/
  12          /*************************/
  13          PLAY_MODE_TypeDef  PlayMode_TypeDef;
  14          CONTROL_COMMAND_TypeDef Ctrl_Com_TypeDef;
  15          
  16          /****************************/
  17          /*±êÖ¾Î»¶¨Òåflags definetion*/
  18          /****************************/
  19          bit     AppTick0;
  20          bit     AppTick1;
  21          bit     AppTick2;
  22          bit     AppTick3;
  23          bit     AppTick4;
  24          bit     AppTick5;
  25          bit     AppTick1ms;
  26          uint8_t Flag_DaylightSaving;//ÊÇ·ñÉèÖÃÏÄÁîÊ±±êÖ¾£¬ÕâÑù£¬Èç¹û¼ÓÒ»¸öÐ¡Ê±Ö»ÄÜ¼ÓÒ»´Î£¬
  27                                                              //1Îª¼ÓÁËÒ»¸öÐ¡Ê±£¬2Îª¼õÁËÒ»¸öÐ¡Ê±
  28          uint8_t Flag_Alarm1_IQ_BTOrBEEp;//ÄÖÖÓ1ÏìÓ¦Ê±ÏÈ²éÑ¯ÊÇÀ¶ÑÀÓÐÃ»ÓÐÔÙ²¥·Å£¬Èç¹ûÔÚ²¥·Å²¢ÇÒÄÖÖÓÓ°Ïì
  29                                                                          //¹¤×÷Ä£Ê½ÎªÀ¶ÑÀ²¥·Å£¬¾Í°ÑÄÖÖÓ¹¤×÷Ä£Ê½×ªÎªbeep
  30          
  31          BOOL  gb12HourDisp;
  32          BOOL  gb0_5s;
  33          BOOL  gbUser_AdjClk;
  34          BOOL  gbHalfSecond;
  35          BOOL  gbTestMode;
  36          BOOL  gbSnoozeEnable;
  37          BOOL  gbPowerOn;
  38          BOOL  gbSleepEnable;
  39          
  40          uint8_t Flag_DispStatus;
  41          
  42          /*****************************/
  43          /*±äÁ¿¶¨Òåvariable definition*/
  44          /*****************************/
  45          uint8_t  idata cntAppTick;
  46          bit                        gbHalfSecond;
  47          uint8_t  idata gRTC_Sec;//RTCÊý¾Ý 
  48          uint8_t  idata gRTC_Sec_bk;
  49          uint8_t  idata gRTC_Minute;
  50          uint8_t  idata gRTC_Minute_bk;
  51          uint8_t  idata gRTC_Hour;
  52          uint8_t  idata gRTC_Hour_bk;
  53          uint8_t  idata gRTC_Hour_bk_24;//¼ÆÊý24Ð¡Ê±
  54          uint8_t  idata gRTC_Week; //Ò»ÖÜ7Ìì
C51 COMPILER V9.00   APP_MAIN                                                              11/24/2018 11:14:26 PAGE 2   

  55          uint8_t  idata Snooze_Hour;//Ì°Ë¯Ð¡Ê±Ê±¼ä
  56          uint8_t  idata Snooze_Minute;//Ì°Ë¯·ÖÖÓÊ±¼ä
  57          uint8_t  idata sysVolume;//ÏµÍ³ÒôÁ¿
  58          uint8_t  idata sys_Cmd;//ÃüÁî
  59          uint8_t  idata sys_Name;
  60          uint16_t idata timeCnt_30Sec;//¶Ì°´ALARM¼üÈ±ÈËÉèÖÃ»ò²»¶¯×÷30s×Ô¶¯±£´æ£¬30s¼ÆÊ±
  61          
  62          uint8_t  idata cntAlarm;
  63          uint8_t  idata cntSleep;
  64          uint8_t  idata sleepTimeSet;
  65          uint8_t  idata cntNoFlash;
  66          uint8_t  idata AlarmingType;//ÄÖÖÓÊ±¿ªÆô»¹ÊÇ¹Ø±Õ£¬ÓÃAlarm1_TypeDef.Alarm_OnOFF´úÌæ
  67          uint8_t  idata Alarm1Mode;//ÓÃAlarm1_TypeDef.Alarm_Mode´úÌæÁË
  68          uint8_t            gZone;
  69          uint8_t  idata cnt0_5s;//Í¨¹ýÕâ¸ö±äÁ¿µÄ¼ÆÊýÀ´¶Ôgb0_5sµÄ×´Ì¬Á¬ÐøÈ¡·´£¬Ã¿´ÎÈ¡·´0.5s
  70          uint16_t       cntDispStatus;
  71          uint8_t        cntJustPower_AllLED_2s;//¸ÕÉÏµçÈ«²¿LEDÏÔÊ¾2s
  72          
  73          uint16_t idata cntBT_Connect_30s;//ÄÖÖÓÏìÊ±À¶ÑÀÄ£Ê½ÏÂÈç¹ûÃ»ÓÐÁ¬½Óµ½À¶ÑÀ¾Í¼ÆÊý30s
  74          uint8_t  idata cntAlarm_Runing_60Min;//ÄÖÖÓµ½Ê±Ïì60·ÖÖÓ£»
  75          uint32_t idata cntSnooze_9Min;//
  76          uint8_t  idata cntBeep;//ÄÖÖÓÏìÊ±²¢ÇÒÎªbeepÄ£Ê½£¬¾ÍÏì1s£¬¹Ø0.5s
  77          uint8_t  idata cntAlarm1_IQ_BTOrBEEp;//ÄÖÖÓ1ÏìÓ¦Ê±ÏÈ²éÑ¯ÊÇÀ¶ÑÀÓÐÃ»ÓÐÔÙ²¥·Å£¬Èç¹ûÔÚ²¥·Å²¢ÇÒÄÖÖÓÓ°Ïì
  78                                                                          //¹¤×÷Ä£Ê½ÎªÀ¶ÑÀ²¥·Å£¬¾Í°ÑÄÖÖÓ¹¤×÷Ä£Ê½×ªÎªbeep
  79          
  80          /**************************/
  81          /*Êý×é¶¨Òåarray definition*/
  82          /**************************/
  83          
  84          /******************************/
  85          /*º¯ÊýÉùÃ÷Function declaration*/
  86          /******************************/
  87          
  88          /*****************************/
  89          /*º¯Êý¶¨Òåfunction definetion*/
  90          /*****************************/
  91          /*******************************************************************************
  92           * º¯ÊýÔ­ÐÍ£º
  93           * ÊäÈë²ÎÊý£º
  94           * Êä³ö²ÎÊý£º
  95           * º¯Êý¹¦ÄÜ£º°ÑÏÔÊ¾×´Ì¬ÇåÁã
  96           * ·µ»ØÖµËµÃ÷£º
  97           * ´´½¨ÈÕÆÚ£º
  98           * ´´½¨ÈË£º
  99           * ÐÞ¸ÄÈÕÆÚ
 100           * ÐÞ¸ÄÈË£º
 101           * µÚN´ÎÐÞ¸Ä£º
 102           * ÐÞ¸ÄÔ­Òò£º
 103           * ±¸×¢£º
 104           *******************************************************************************/
 105          void ClearDisplayStatus(void)
 106          {
 107   1              Flag_DispStatus = 0;
 108   1              cntDispStatus = 0;
 109   1      }
 110          
 111           /*******************************************************************************
 112            * º¯ÊýÔ­ÐÍ£º
 113            * ÊäÈë²ÎÊý£º
 114            * Êä³ö²ÎÊý£º
 115            * º¯Êý¹¦ÄÜ£ºË¯Ãß»½ÐÑÖ®ºóÇå³ýÏà¹Ø±êÖ¾Î»ºÍ¼ÆÊýÊ²Ã´µÄ±äÁ¿
 116            * ·µ»ØÖµËµÃ÷£º
C51 COMPILER V9.00   APP_MAIN                                                              11/24/2018 11:14:26 PAGE 3   

 117            * ´´½¨ÈÕÆÚ£º
 118            * ´´½¨ÈË£º
 119            * ÐÞ¸ÄÈÕÆÚ
 120            * ÐÞ¸ÄÈË£º
 121            * µÚN´ÎÐÞ¸Ä£º
 122            * ÐÞ¸ÄÔ­Òò£º
 123            * ±¸×¢£º
 124            *******************************************************************************/
 125          void Clear_Sleep(void)
 126          {
 127   1              cntSleep = 0;
 128   1              sleepTimeSet = 0;
 129   1              gbSleepEnable = 0;
 130   1      }
 131          
 132            /*******************************************************************************
 133             * º¯ÊýÔ­ÐÍ£º
 134             * ÊäÈë²ÎÊý£º
 135             * Êä³ö²ÎÊý£º
 136             * º¯Êý¹¦ÄÜ£ºÍË³öÏÔÊ¾×´Ì¬
 137             * ·µ»ØÖµËµÃ÷£º
 138             * ´´½¨ÈÕÆÚ£º
 139             * ´´½¨ÈË£º
 140             * ÐÞ¸ÄÈÕÆÚ
 141             * ÐÞ¸ÄÈË£º
 142             * µÚN´ÎÐÞ¸Ä£º
 143             * ÐÞ¸ÄÔ­Òò£º
 144             * ±¸×¢£º
 145             *******************************************************************************/
 146          void DisplayStatusExit(void)
 147          {
 148   1              if (cntDispStatus)
 149   1              {
 150   2                      if (++cnt0_5s >= cDISP_DELAY__500ms)//10msµ÷ÓÃÒ»´Î£¬¼ÆÊýµ½500ms¾Í½øÈë
 151   2                      {
 152   3                              cnt0_5s = 0;
 153   3                              gb0_5s = ~gb0_5s;
 154   3                      }
 155   2                      if (--cntDispStatus == 0)
 156   2                      {
 157   3                              switch (Flag_DispStatus)
 158   3                              {
 159   4                                      case DISP_CLK:
 160   4                                              break;
 161   4                                      case DISP_GET_MEN:
 162   4                                              SetDisplayState10s(DISP_RADIO);
 163   4                                              break;
 164   4                                      default:
 165   4                                              cntDispStatus = cDISP_DELAY__60ms;
 166   4                                              Flag_DispStatus = DISP_CLK;
 167   4                                              break;
 168   4                              }
 169   3                      }
 170   2              }
 171   1      }
 172          
 173          /*******************************************************************************
 174          * º¯ÊýÔ­ÐÍ£º
 175          * ÊäÈë²ÎÊý£º
 176          * Êä³ö²ÎÊý£º
 177          * º¯Êý¹¦ÄÜ£º
 178          * ·µ»ØÖµËµÃ÷£º
C51 COMPILER V9.00   APP_MAIN                                                              11/24/2018 11:14:26 PAGE 4   

 179          * ´´½¨ÈÕÆÚ£º
 180          * ´´½¨ÈË£º
 181          * ÐÞ¸ÄÈÕÆÚ
 182          * ÐÞ¸ÄÈË£º
 183          * µÚN´ÎÐÞ¸Ä£º
 184          * ÐÞ¸ÄÔ­Òò£º
 185          * ±¸×¢£º
 186          *******************************************************************************/
 187          void Snooze_9Min(void)
 188          {
 189   1      //      uint8_t cnt;
 190   1      //      Snooze_Hour = gRTC_Hour;//°ÑÏÖÔÚRTCÊ±¼ä¸³¸øÌ°Ë¯Ê±¼äÕâÑùÔÙ¼ÆÊý9·ÖÖÓÔÙÓëRTCÊ±¼ä¶Ô±È
 191   1      //      Snooze_Minute = gRTC_Minute;
 192   1      //      for (cnt = 0; cnt < 9; cnt++)//ÕâÀïÖ®ËùÒÔ½øÐÐ9´ÎifÅÐ¶Ï
 193   1      //      {
 194   1      //              if (++Snooze_Minute >= 60)
 195   1      //              {
 196   1      //                      Snooze_Minute = 0;
 197   1      //                      if (++Snooze_Hour >= 24)
 198   1      //                      {
 199   1      //                              Snooze_Hour = 0;
 200   1      //                      }
 201   1      //              }
 202   1      //      }
 203   1      }
 204          
 205          /*******************************************************************************
 206          * º¯ÊýÔ­ÐÍ£º
 207          * ÊäÈë²ÎÊý£º
 208          * Êä³ö²ÎÊý£º
 209          * º¯Êý¹¦ÄÜ£ºÄÖÖÓÏìÊ±°´ÏÂSNOOZE(Ì°Ë¯)°´¼ü£¬¼ÌÐøÌ°Ë¯9·ÖÖÓ
 210          * ·µ»ØÖµËµÃ÷£º
 211          * ´´½¨ÈÕÆÚ£º
 212          * ´´½¨ÈË£º
 213          * ÐÞ¸ÄÈÕÆÚ
 214          * ÐÞ¸ÄÈË£º
 215          * µÚN´ÎÐÞ¸Ä£º
 216          * ÐÞ¸ÄÔ­Òò£º
 217          * ±¸×¢£º
 218          *******************************************************************************/
 219          void SnoozeEnable(void)
 220          {
 221   1              if (!gbSnoozeEnable)
 222   1              {
 223   2                      if (cntAlarm)
 224   2                      {
 225   3                              //__enMute();
 226   3                              gbPowerOn = 0;
 227   3                              Snooze_9Min();
 228   3                              SetDisplayState10s(DISP_CLK);
 229   3                              //BuzzEventPorc(eAL_AL_IDLE);//Õâ¸öº¯Êý»¹Ã»ÓÐÐ´ÄØ
 230   3                              gbSnoozeEnable = 1;//Ì°Ë¯±êÖ¾Î»ÖÃ1£¬Æô¶¯Ì°Ë¯
 231   3                      }
 232   2              }
 233   1      }
 234          
 235          /*******************************************************************************
 236          * º¯ÊýÔ­ÐÍ£º
 237          * ÊäÈë²ÎÊý£º
 238          * Êä³ö²ÎÊý£º
 239          * º¯Êý¹¦ÄÜ£º¸ÕÉÏµçÈ«²¿LEDÏÔÊ¾2s£¬ÕâÀïÊÇ°Ñ_SET_xx(Flag_SET_xx)ÖÐµÄFlag_SET_xxÖÃÒ»£¬
 240          *                       ÔÚ¶¨Ê±Æ÷ÈýÖÖµ÷ÓÃÊ±¾Í»áÁÁ£¬²¢ÇÒÁÁ¶ÈÎª×î¸ß
C51 COMPILER V9.00   APP_MAIN                                                              11/24/2018 11:14:26 PAGE 5   

 241          * ·µ»ØÖµËµÃ÷£º
 242          * ´´½¨ÈÕÆÚ£º
 243          * ´´½¨ÈË£º
 244          * ÐÞ¸ÄÈÕÆÚ
 245          * ÐÞ¸ÄÈË£º
 246          * µÚN´ÎÐÞ¸Ä£º
 247          * ÐÞ¸ÄÔ­Òò£º
 248          * ±¸×¢£º
 249          *******************************************************************************/
 250          void JustPower_AllLED_Flag(void)
 251          {
 252   1              LED_Brightness_TypeDef = LED_HIGH;
 253   1              Flag_SET_1B=1;
 254   1              Flag_SET_1C=1;
 255   1              Flag_SET_2A=1;
 256   1              Flag_SET_2B=1;
 257   1              Flag_SET_2C=1;
 258   1              Flag_SET_2D=1;
 259   1              Flag_SET_2E=1;
 260   1              Flag_SET_2F=1;
 261   1              Flag_SET_2G=1;
 262   1              Flag_SET_3A=1;
 263   1              Flag_SET_3B=1;
 264   1              Flag_SET_3C=1;
 265   1              Flag_SET_3D=1;
 266   1              Flag_SET_3E=1;
 267   1              Flag_SET_3F=1;
 268   1              Flag_SET_3G=1;
 269   1              Flag_SET_4A=1;
 270   1              Flag_SET_4B=1;
 271   1              Flag_SET_4C=1;
 272   1              Flag_SET_4D=1;
 273   1              Flag_SET_4E=1;
 274   1              Flag_SET_4F=1;
 275   1              Flag_SET_4G=1;
 276   1              Flag_SET_APM=1;
 277   1              Flag_SET_AL=1;
 278   1              Flag_SET_COL1=1;
 279   1              Flag_SET_COL2=1;
 280   1              Flag_SET_BT_BLUE=1;
 281   1              Flag_SET_BT_RED=1;
 282   1      }
 283          
 284          /*******************************************************************************
 285          * º¯ÊýÔ­ÐÍ£º
 286          * ÊäÈë²ÎÊý£º
 287          * Êä³ö²ÎÊý£º
 288          * º¯Êý¹¦ÄÜ£º¸ÕÉÏµçÈ«²¿LEDÏÔÊ¾2s¼ÆÊý,Èç¹û¼ÆÊýÍê±Ï¾ÍÇå³ý±êÖ¾Î»£¬ÍË³öwhile(cntJustPower_AllLED_2s)
 289          * ·µ»ØÖµËµÃ÷£º
 290          * ´´½¨ÈÕÆÚ£º
 291          * ´´½¨ÈË£º
 292          * ÐÞ¸ÄÈÕÆÚ
 293          * ÐÞ¸ÄÈË£º
 294          * µÚN´ÎÐÞ¸Ä£º
 295          * ÐÞ¸ÄÔ­Òò£º
 296          * ±¸×¢£º
 297          *******************************************************************************/
 298          void JustPower_AllLED_2s(void)
 299          {
 300   1              cntJustPower_AllLED_2s--;
 301   1              if(cntJustPower_AllLED_2s==0)
 302   1              {
C51 COMPILER V9.00   APP_MAIN                                                              11/24/2018 11:14:26 PAGE 6   

 303   2      
 304   2                      WT_init();//¿ªÆôWTÖÐ¶Ï
 305   2                      Flag_SET_1B=0;
 306   2                      Flag_SET_1C=0;
 307   2                      Flag_SET_2A=0;
 308   2                      Flag_SET_2B=0;
 309   2                      Flag_SET_2C=0;
 310   2                      Flag_SET_2D=0;
 311   2                      Flag_SET_2E=0;
 312   2                      Flag_SET_2F=0;
 313   2                      Flag_SET_2G=0;
 314   2                      Flag_SET_3A=0;
 315   2                      Flag_SET_3B=0;
 316   2                      Flag_SET_3C=0;
 317   2                      Flag_SET_3D=0;
 318   2                      Flag_SET_3E=0;
 319   2                      Flag_SET_3F=0;
 320   2                      Flag_SET_3G=0;
 321   2                      Flag_SET_4A=0;
 322   2                      Flag_SET_4B=0;
 323   2                      Flag_SET_4C=0;
 324   2                      Flag_SET_4D=0;
 325   2                      Flag_SET_4E=0;
 326   2                      Flag_SET_4F=0;
 327   2                      Flag_SET_4G=0;
 328   2                      Flag_SET_APM=0;
 329   2                      Flag_SET_AL=0;
 330   2                      Flag_SET_COL1=0;
 331   2                      Flag_SET_COL2=0;
 332   2                      Flag_SET_BT_BLUE=0;
 333   2              }
 334   1      }
 335          
 336          /*******************************************************************************
 337          * º¯ÊýÔ­ÐÍ£º
 338          * ÊäÈë²ÎÊý£º
 339          * Êä³ö²ÎÊý£º
 340          * º¯Êý¹¦ÄÜ£º¸ÕÉÏµçÈ«²¿LEDÏÔÊ¾2s¼ÆÊý
 341          * ·µ»ØÖµËµÃ÷£º
 342          * ´´½¨ÈÕÆÚ£º
 343          * ´´½¨ÈË£º
 344          * ÐÞ¸ÄÈÕÆÚ
 345          * ÐÞ¸ÄÈË£º
 346          * µÚN´ÎÐÞ¸Ä£º
 347          * ÐÞ¸ÄÔ­Òò£º
 348          * ±¸×¢£º
 349          *******************************************************************************/
 350          void JustPower_AllLED(void)
 351          {
 352   1              WT_Def_Init();//ÏÈ¹Ø±ÕWTÖÐ¶Ï£¬²»ÈÃRTC±äÁ¿ÓÐËù±ä»¯
 353   1              if(AppTick1ms)
 354   1              {
 355   2                      AppTick1ms=0;
 356   2              }
 357   1              if(AppTick0)
 358   1              {
 359   2                      //CheckDC();
 360   2                      AppTick0=0;
 361   2              }
 362   1              if(AppTick1)
 363   1              {
 364   2                      AppTick1=0;
C51 COMPILER V9.00   APP_MAIN                                                              11/24/2018 11:14:26 PAGE 7   

 365   2              }
 366   1              if(AppTick2)
 367   1              {
 368   2                      AppTick2=0;
 369   2              }
 370   1              if(AppTick3)
 371   1              {
 372   2                      AppTick3=0;
 373   2              }
 374   1              if(AppTick4)
 375   1              {
 376   2                      AppTick4=0;
 377   2                      JustPower_AllLED_Flag();
 378   2              }
 379   1              if(AppTick5)
 380   1              {
 381   2                      AppTick5=0;
 382   2                      JustPower_AllLED_2s();
 383   2              }
 384   1              WDT_clear();
 385   1      }
 386          
 387          
 388          /*******************************************************************************
 389           * º¯ÊýÔ­ÐÍ£º
 390           * ÊäÈë²ÎÊý£º
 391           * Êä³ö²ÎÊý£º
 392           * º¯Êý¹¦ÄÜ£ºÊ±¼ä±È½Ï£¬°ÑRTCÊ±¼äÓëÄ³¸ö¶¨Ê±Ê±¼ä±È½Ï£¬±ÈÈçÄÖÖÓ
 393           * ·µ»ØÖµËµÃ÷£º
 394           * ´´½¨ÈÕÆÚ£º
 395           * ´´½¨ÈË£º
 396           * ÐÞ¸ÄÈÕÆÚ
 397           * ÐÞ¸ÄÈË£º
 398           * µÚN´ÎÐÞ¸Ä£º
 399           * ÐÞ¸ÄÔ­Òò£º
 400           * ±¸×¢£º
 401           *******************************************************************************/
 402          void Compare_1MinutePorc(void)
 403          {
 404   1              //static uint8_t  cntSetVolume; //´Ë±äÁ¿Ö»ÔÚÉÏµçÊ±³õÊ¼»¯Ò»´Î£¬ÔÙµ÷ÓÃ´Ëº¯ÊýÊ±²»»áÖ´ÐÐ´ËÓï¾ä
 405   1              /*******************************************************************************
 406   1               *¹¦ÄÜ£º
 407   1               *ÕâÀïÊÇ1s½øÀ´Ò»´Î
 408   1               *******************************************************************************/
 409   1              if(gRTC_Sec!=gRTC_Sec_bk)
 410   1              {
 411   2                      gRTC_Sec_bk=gRTC_Sec;
 412   2                      /*******************************************************************************
 413   2                       *¹¦ÄÜ£ºÈç¹ûÄÖÖÓÊ±¼äµ½ÏÈÅÐ¶ÏÊÇ²»ÊÇÀ¶ÑÀÕýÔÚ²¥·Å£¬²¢ÇÒÅÐ¶ÏÄÖÖÓÏìÓ¦¹¤×÷Ä£Ê½ÊÇ²»ÊÇ
 414   2                       *              À¶ÑÀÄ£Ê½£¬Èç¹ûÊÇÀ¶ÑÀÄ£Ê½£¬²¢ÇÒÀ¶ÑÀÕýÔÚ²¥·Å(Flag_Alarm1_IQ_BTOrBEEp¾ÍÎª2)
 415   2                       *              ¾Í×ªÎªbeepÄ£Ê½£¬²¢°ÑÕýÔÚ²¥·ÅµÄÀ¶ÑÀ¹Øµô¡£Èç¹ûÃ»ÓÐÕýÔÚ²¥·Å£¬¾Í»ØÁ¬À¶ÑÀ£¬¿ª
 416   2                       *              ÆôÄÖÖÓ£¬Èç¹û30sÄÚÃ»ÓÐÁ¬½Óµ½À¶ÑÀ£¬¾Í×ªÎªbeep¡£ÒòÎª´ÓFlag_Alarm1_IQ_BTOrBEEp
 417   2                       *              ¸³ÖµÎª1£¬ÔÙÖØÐÂÖ´ÐÐµ½ÕâÀïÊÇ¹ýÈ¥ÁË1s£¬´®¿Ú·¢ËÍ²éÑ¯ÔÙ½ÓÊÜÊ±¼äÊÇ¹»µÃ£¬ËùÒÔ
 418   2                       *              Èç¹ûÕâÀïFlag_Alarm1_IQ_BTOrBEEpÒÀÈ»Îª1ÄÇ¾ÍÊÇÀ¶ÑÀÃ»ÓÐÔÚ²¥·Å£¬¾Í¿ªÆôÀ¶ÑÀ»ØÁ¬
 419   2                       *ÕâÀïÊÇ1s½øÀ´Ò»´Î
 420   2                       *******************************************************************************/
 421   2                      if(Flag_Alarm1_IQ_BTOrBEEp==2)//ÄÖÖÓ¹¤×÷Ä£Ê½ÎªÀ¶ÑÀ£¬²¢ÇÒÀ¶ÑÀÔÚ²¥·Å
 422   2                      {
 423   3                              Alarm1_TypeDef.Alarm_RingRun=ALARM_RING_RUN_ON;
 424   3                              Alarm1_TypeDef.Alarm_WorkMode=ALARM_BEEP;
 425   3                              Flag_Alarm1_IQ_BTOrBEEp=0;//Çåµô±êÖ¾£¬ÎªÏÂ´Î×ö×¼±¸
 426   3                              bt_cmd=BT_PAUSE;//°ÑÀ¶ÑÀµÄ²¥·ÅÔÝÍ£
C51 COMPILER V9.00   APP_MAIN                                                              11/24/2018 11:14:26 PAGE 8   

 427   3                      }
 428   2                      else if(Flag_Alarm1_IQ_BTOrBEEp==1)//ÄÖÖÓ¹¤×÷Ä£Ê½ÎªÀ¶ÑÀ£¬À¶ÑÀÃ»ÓÐÔÚ²¥·Å
 429   2                      {
 430   3                              Alarm1_TypeDef.Alarm_RingRun=ALARM_RING_RUN_ON;
 431   3                              Flag_Alarm1_IQ_BTOrBEEp=0;//Çåµô±êÖ¾£¬ÎªÏÂ´Î×ö×¼±¸
 432   3                              //ÕâÀï²»ÓÃ·¢ËÍ»ØÁ¬£¬ÏÂÃæÓÐ
 433   3                      }
 434   2                      
 435   2                      if(gRTC_Minute!=gRTC_Minute_bk)//·ÖÖÓ
 436   2                      {
 437   3                              gRTC_Minute_bk=gRTC_Minute;
 438   3                              /*******************************************************************************
 439   3                               *¹¦ÄÜ£ºÄÖÖÓ¶¨Ê±¼ì²âÊÇ·ñ¿ªÆô£¬²¢ÇÒÊÇ·ñÊ±¼äµ½
 440   3                               *ÕâÀïÊÇ1min½øÀ´Ò»´Î
 441   3                               *******************************************************************************/
 442   3                              if((Alarm1_TypeDef.Alarm_OnOff == ALARM_ON) && (gRTC_Hour == Alarm1_TypeDef.hour) && (gRTC_Minute == Al
             -arm1_TypeDef.minute))
 443   3                              {
 444   4                                      if(Alarm1_TypeDef.Alarm_RingRun == ALARM_RING_RUN_OFF)
 445   4                                      {
 446   5                                              //Alarm1_TypeDef.Alarm_RingRun=ALARM_RING_RUN_ON;
 447   5                                              if(Alarm1_TypeDef.Alarm_WorkMode==ALARM_BT)
 448   5                                              {
 449   6                                                      bt_cmd=BT_IQ;
 450   6                                                      Flag_Alarm1_IQ_BTOrBEEp=1;
 451   6                                              }
 452   5                                              
 453   5                                      }
 454   4                              }
 455   3                              /*******************************************************************************
 456   3                               *¹¦ÄÜ£ºÄÖÖÓ×ÜµÄÏìÓ¦Ê±¼ä(°üÀ¨Ì°Ë¯)Îª60·Ö£¬ÄÖÖÓÒ»Ïì¾Í¿ªÊ¼¼ÆÊ±
 457   3                               *******************************************************************************/
 458   3                              if((Alarm1_TypeDef.Alarm_OnOff == ALARM_ON) && (Alarm1_TypeDef.Alarm_RingRun == ALARM_RING_RUN_ON))
 459   3                              {
 460   4                                      cntAlarm_Runing_60Min++;
 461   4                                      if(cntAlarm_Runing_60Min>=60)
 462   4                                      {
 463   5                                              Alarm1_PowerOFF();
 464   5                                      }
 465   4                                      if(Alarm1_TypeDef.Alarm_Snooze == ALARM_SNOOZE_ON)//Èç¹ûÊÇÌ°Ë¯Ä£Ê½
 466   4                                      {
 467   5                                              cntSnooze_9Min++;
 468   5                                              if(cntSnooze_9Min>=9)
 469   5                                              {
 470   6                                                      cntSnooze_9Min=0;
 471   6                                                      Alarm1_TypeDef.Alarm_Snooze = ALARM_SNOOZE_OFF;//Ì°Ë¯Ê±¼äµ½£¬¹Ø±ÕÌ°Ë¯Ä£Ê½
 472   6                                              }
 473   5                                      }
 474   4                              }
 475   3                              
 476   3                              /*******************************************************************************
 477   3                               *¹¦ÄÜ£º
 478   3                               *ÕâÀïÊÇ1hour½øÀ´Ò»´Î
 479   3                               *******************************************************************************/
 480   3                              if(gRTC_Hour!=gRTC_Hour_bk)//Ð¡Ê±
 481   3                              {
 482   4                                      gRTC_Hour_bk=gRTC_Hour_bk;
 483   4                                      gRTC_Hour_bk_24++;
 484   4                                      if(gRTC_Hour_bk_24>=24)
 485   4                                      {
 486   5                                              gRTC_Hour_bk_24=0;
 487   5                                              
C51 COMPILER V9.00   APP_MAIN                                                              11/24/2018 11:14:26 PAGE 9   

 488   5                                      }
 489   4                              }
 490   3                      }
 491   2              }
 492   1              /*******************************************************************************
 493   1               *¹¦ÄÜ£ºÄÖÖÓ¿ªÆô£¬²¢ÇÒÒÑ¾­ÏìÓ¦
 494   1               *ÕâÀïÊÇ10ms½øÀ´Ò»´Î
 495   1               *******************************************************************************/
 496   1              if((Alarm1_TypeDef.Alarm_OnOff == ALARM_ON) && (Alarm1_TypeDef.Alarm_RingRun == ALARM_RING_RUN_ON))
 497   1              {
 498   2                      if(Alarm1_TypeDef.Alarm_Snooze == ALARM_SNOOZE_OFF)//Èç¹û²»µÈÓÚÌ°Ë¯Ä£Ê½
 499   2                      {
 500   3                              if(Alarm1_TypeDef.Alarm_WorkMode==ALARM_BT)//ÄÖÖÓ¹¤×÷Ä£Ê½ÎªÀ¶ÑÀ
 501   3                              {
 502   4                                      if(Flag_BT_Connect==1)//ËµÃ÷À¶ÑÀÁ¬½Ó³É¹¦
 503   4                                      {
 504   5                                              //if(!Flag_BT_Play)
 505   5                                              if(Flag_BT_Play==0)
 506   5                                              {
 507   6                                                      Flag_BT_Play=1;
 508   6                                                      cntBT_Connect_30s=0;
 509   6                                                      bt_cmd=BT_PLAY;
 510   6                                              }
 511   5                                              else if(Flag_BT_Play==1)
 512   5                                              {
 513   6                                                      //Flag_BT_Play=2;
 514   6                                                      cntBT_Connect_30s++;
 515   6                                                      if((cntBT_Connect_30s%100)==0)//1s·¢ËÍÒ»´Î»ØÁ¬£¬µÚÒ»´ÎÎª0Ê±·¢ËÍÒªÔÚ"cntBT_Connect_30s++;"Ç°Ãæ
 516   6                                                              bt_cmd=BT_PLAY;
 517   6                                                      
 518   6                                                      //bt_cmd=BT_PLAY;
 519   6                                              }
 520   5                                      }
 521   4                                      else
 522   4                                      {
 523   5                                              if((cntBT_Connect_30s%100)==0)//1s·¢ËÍÒ»´Î»ØÁ¬£¬µÚÒ»´ÎÎª0Ê±·¢ËÍÒªÔÚ"cntBT_Connect_30s++;"Ç°Ãæ
 524   5                                                      bt_cmd=BT_LINK_BACK;     //²»È»"++"Ö®ºó¾ÍÎª1£¬·¢ËÍ²»ÁË£¬ÒªµÈµ½100²ÅÄÜ·¢ËÍÁË
 525   5                                              cntBT_Connect_30s++;
 526   5                                              Flag_BT_Play=0;
 527   5                                              if(cntBT_Connect_30s>=3000)//30sÊ±¼äµ½
 528   5                                              {
 529   6                                                      cntBT_Connect_30s=0;
 530   6                                                      if(Flag_BT_Connect==0)
 531   6                                                      {
 532   7                                                              Alarm1_TypeDef.Alarm_WorkMode=ALARM_BEEP;//ÇÐ»»µ½beepÄ£Ê½
 533   7                                                      }
 534   6                                              }
 535   5                                      }
 536   4                              }
 537   3                              else
 538   3                              {
 539   4                                      if(Alarm1_TypeDef.Alarm_WorkMode==ALARM_BEEP)//ÄÖÖÓ¹¤×÷Ä£Ê½Îªbeep
 540   4                                      {
 541   5                                              //BUZ_OnOff(1);
 542   5                                              __DE_MUTE();
 543   5                                              cntBeep++;
 544   5                                              if(cntBeep<40)//0.3s
 545   5                                                      BUZ_OnOff(1);
 546   5                                              else if((cntBeep>=40) && (cntBeep<80))//0.5s-0.7s
 547   5                                                      BUZ_OnOff(0);
 548   5                                              else
 549   5                                                      cntBeep=0;
C51 COMPILER V9.00   APP_MAIN                                                              11/24/2018 11:14:26 PAGE 10  

 550   5                                      }
 551   4                              }
 552   3                      }
 553   2                      else//Èç¹ûµÈÓÚÌ°Ë¯Ä£Ê½
 554   2                      {
 555   3                              BUZ_OnOff(0);
 556   3                              __EN_MUTE();
 557   3                              if(Flag_BT_Play)
 558   3                              {
 559   4                                      Flag_BT_Play=0;
 560   4                                      bt_cmd=BT_PAUSE;//Èç¹ûÊÇÀ¶ÑÀÄ£Ê½¾ÍÔÝÍ£²¥·Å
 561   4                              }
 562   3                      }
 563   2              }
 564   1                      
 565   1      }
 566          
 567          /*******************************************************************************
 568           * º¯ÊýÔ­ÐÍ£º
 569           * ÊäÈë²ÎÊý£º
 570           * Êä³ö²ÎÊý£º
 571           * º¯Êý¹¦ÄÜ£ºÆäËû³ÌÐòÐèÒªÓÃµ½µÄ¼ÆÊ±·ÅÔÚÕâÀï½øÐÐ
 572           * ·µ»ØÖµËµÃ÷£º
 573           * ´´½¨ÈÕÆÚ£º
 574           * ´´½¨ÈË£º
 575           * ÐÞ¸ÄÈÕÆÚ
 576           * ÐÞ¸ÄÈË£º
 577           * µÚN´ÎÐÞ¸Ä£º
 578           * ÐÞ¸ÄÔ­Òò£º
 579           * ±¸×¢£º
 580           *******************************************************************************/
 581          void Timing_Handle(void)
 582          {
 583   1              if (Time_Temp_TypeDef.Flag_Confirm_30Sec == 2)
 584   1              {
 585   2                      timeCnt_30Sec++;
 586   2                      if (timeCnt_30Sec >= 3000)//30s
 587   2                      {
 588   3                              Time_Temp_TypeDef.Flag_Confirm_30Sec = 0;
 589   3                              FlagKSet_TypeDef = FLAG_KEYSET_OFF;
 590   3                              timeCnt_30Sec = 0;
 591   3                              gRTC_Hour   = Time_Temp_TypeDef.temp_RTC_Hour; //30s¼ÆÊ±½áÊø°ÑÉè¶¨µÄÁÙÊ±RTCÊ±¼ä¸¶¸øÒ»Ö±ÔÚÔËÐÐµÄRTCÊ±¼ä
 592   3                              gRTC_Minute = Time_Temp_TypeDef.temp_RTC_Minute;
 593   3                              Flag_DispStatus=0;
 594   3                      }
 595   2              }
 596   1              else if (Alarm1_TypeDef.Flag_Confirm_30Sec == 2)
 597   1              {
 598   2                      timeCnt_30Sec++;
 599   2                      if (timeCnt_30Sec >= 3000)//30s
 600   2                      {
 601   3                              Alarm1_TypeDef.Flag_Confirm_30Sec = 0;
 602   3                              FlagKSet_TypeDef = FLAG_KEYSET_OFF;
 603   3                              timeCnt_30Sec = 0;
 604   3                              Alarm1_TypeDef.hour   = Alarm1_TypeDef.tempHour;//30s¼ÆÊ±½áÊø°ÑÉè¶¨µÄÄÖÖÓÊ±¼ä¸³¸øÓëRTC±È¶ÔµÄÄÖÖÓ±äÁ¿
 605   3                              Alarm1_TypeDef.minute = Alarm1_TypeDef.tempMinute;
 606   3                              Alarm1_TypeDef.Flag_Again=1;
 607   3                              cntDispStatus=0;
 608   3                              Flag_DispStatus=0;
 609   3                      }
 610   2              }
 611   1              //else
C51 COMPILER V9.00   APP_MAIN                                                              11/24/2018 11:14:26 PAGE 11  

 612   1              //      timeCnt_30Sec = 0;
 613   1      }
 614          
 615          /*******************************************************************************
 616           * º¯ÊýÔ­ÐÍ£º
 617           * ÊäÈë²ÎÊý£º
 618           * Êä³ö²ÎÊý£º
 619           * º¯Êý¹¦ÄÜ£º
 620           * ·µ»ØÖµËµÃ÷£º
 621           * ´´½¨ÈÕÆÚ£º
 622           * ´´½¨ÈË£º
 623           * ÐÞ¸ÄÈÕÆÚ
 624           * ÐÞ¸ÄÈË£º
 625           * µÚN´ÎÐÞ¸Ä£º
 626           * ÐÞ¸ÄÔ­Òò£º
 627           * ±¸×¢£º
 628           *******************************************************************************/
 629          uint16_t cnt_num;
 630          void Sys_Tick(void)
 631          {
 632   1              AppTick1ms=1;
 633   1              if(cntAppTick==0)
 634   1                      AppTick0=1;
 635   1              if(cntAppTick==1)
 636   1                      AppTick1=1;
 637   1              if(cntAppTick==2)
 638   1                      AppTick2=1;
 639   1              if(cntAppTick==3)
 640   1                      AppTick3=1;
 641   1              if(cntAppTick==4)
 642   1                      AppTick4=1;
 643   1              if(cntAppTick==5)
 644   1                      AppTick5=1;
 645   1              if(cntAppTick==6)
 646   1              {
 647   2                      if((--uart1_TX_Timeout)==0)//·¢ËÍ³¬Ê±¾ÍÇåÁã·¢ËÍ±êÖ¾Î»
 648   2                              uart1_EnableSend=0;
 649   2                      if((--uart1_RX_Timeout)==0)
 650   2                              uart1_RX_Pointer=0;
 651   2              }
 652   1              if(++cntAppTick>=10)
 653   1              {
 654   2                      cntAppTick=0;
 655   2              }
 656   1      }
 657          
 658          /*******************************************************************************
 659           * º¯ÊýÔ­ÐÍ£º
 660           * ÊäÈë²ÎÊý£º
 661           * Êä³ö²ÎÊý£º
 662           * º¯Êý¹¦ÄÜ£º
 663           * ·µ»ØÖµËµÃ÷£º
 664           * ´´½¨ÈÕÆÚ£º
 665           * ´´½¨ÈË£º
 666           * ÐÞ¸ÄÈÕÆÚ
 667           * ÐÞ¸ÄÈË£º
 668           * µÚN´ÎÐÞ¸Ä£º
 669           * ÐÞ¸ÄÔ­Òò£º
 670           * ±¸×¢£º
 671           *******************************************************************************/
 672          void PowerON_Reset(void)
 673          {
C51 COMPILER V9.00   APP_MAIN                                                              11/24/2018 11:14:26 PAGE 12  

 674   1              //WDT_init();           // initialize Watch-dog timer
 675   1              PlayMode_TypeDef=PLAY_IN_TIME;//PLAY_JUST_POWER;//¸ÕÉÏµç£¬Ä£Ê½ÉèÎª¸ÕÉÏµçÄ£Ê½
 676   1              LED_Brightness_TypeDef=LED_HIGH;//ÁÁ¶ÈÄ¬ÈÏÎª¸ß
 677   1              Alarm1_TypeDef.Alarm_WorkMode=ALARM_BEEP; //×Ô¼º¼ÓµÄÎªÄÖÖÓÏìÄÖÄ£Ê½ÎªbeepÄ£Ê½£¬·½±ãÐ´³ÌÐò£¬Ò²·ÀÖ¹Ê¹ÓÃÕßÔÚÉ
             -èÖÃÄÖÖÓ
 678   1                                                                                              //Ê±Ã»ÓÐÑ¡ÔñÄ£Ê½£¬ÄÇ¾ÍÑ¡ÔñÄ¬ÈÏÊÇbeepÄ£Ê½
 679   1              Music_Mode_TypeDef = MUSIC_OFF;
 680   1              __BT_CLR_POWER();
 681   1              cntJustPower_AllLED_2s=200;//¸ÕÉÏµçÈ«²¿LEDÏÔÊ¾2s
 682   1              sysVolume = 8;//Ä¬ÈÏÏµÍ³ÒôÁ¿Îª8¼¶
 683   1              cntNoFlash = 0;
 684   1              gbUser_AdjClk = 1;
 685   1              gb12HourDisp = 1;
 686   1              gbHalfSecond = 1;
 687   1              gRTC_Sec = 0;
 688   1              gRTC_Minute = 0;
 689   1              gRTC_Hour = 0;
 690   1              gZone = 2;
 691   1              Flag_DaylightSaving=0;//ÏÄÁîÊ±ÇåÁã£¬
 692   1      //      Alarm1Mode = ALARM_NONE;
 693   1      //      Alarm2Mode = ALARM_NONE;
 694   1      //      AlarmingType = ALARM_OFF;
 695   1      
 696   1              gbPowerOn = 0;
 697   1      //      Alarm1_TypeDef.Alarm_OnOff = ALARM_ON;
 698   1      //      Alarm1_TypeDef.hour=0;
 699   1      //      Alarm1_TypeDef.minute=40;
 700   1      }
 701          
 702          /*******************************************************************************
 703           * º¯ÊýÔ­ÐÍ£º
 704           * ÊäÈë²ÎÊý£º
 705           * Êä³ö²ÎÊý£º
 706           * º¯Êý¹¦ÄÜ£º
 707           * ·µ»ØÖµËµÃ÷£º
 708           * ´´½¨ÈÕÆÚ£º
 709           * ´´½¨ÈË£º
 710           * ÐÞ¸ÄÈÕÆÚ
 711           * ÐÞ¸ÄÈË£º
 712           * µÚN´ÎÐÞ¸Ä£º
 713           * ÐÞ¸ÄÔ­Òò£º
 714           * ±¸×¢£º
 715           *******************************************************************************/
 716          void app_main(void)
 717          {
 718   1              PowerON_Reset();
 719   1              while(cntJustPower_AllLED_2s)
 720   1              {
 721   2                      
 722   2                      JustPower_AllLED();
 723   2              }
 724   1              
 725   1              while(1)
 726   1              {
 727   2                      //CheckDC();
 728   2                      if(AppTick1ms)
 729   2                      {
 730   3                              AppTick1ms=0;
 731   3                      }
 732   2                      if(AppTick0)
 733   2                      {
 734   3                              AppTick0=0;
C51 COMPILER V9.00   APP_MAIN                                                              11/24/2018 11:14:26 PAGE 13  

 735   3                              KeyScan();
 736   3                              KeyComMsg();
 737   3                      }
 738   2                      if((AppTick1) || (AppTick2))
 739   2                      {
 740   3                              AppTick1=0;
 741   3                              AppTick2=0;
 742   3                              BlueMode_Handle();
 743   3                              
 744   3                      }
 745   2                      if(AppTick3)
 746   2                      {
 747   3                              AppTick3=0;
 748   3                              Display();
 749   3                              //BUZ_OnOff(1);
 750   3                      }
 751   2                      if(AppTick4)
 752   2                      {
 753   3                              AppTick4=0;
 754   3                              DisplayStatusExit();
 755   3                      }
 756   2                      if(AppTick5)
 757   2                      {
 758   3                              AppTick5=0;
 759   3                              Timing_Handle();
 760   3                              Compare_1MinutePorc();
 761   3                              TF_Check();
 762   3                      }
 763   2                      WDT_clear();    
 764   2              }
 765   1      }
 766          
 767          
 768          
 769          
 770          
 771          
 772          
 773          
 774          
 775          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    968    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     11    ----
   IDATA SIZE       =     32    ----
   BIT SIZE         =     15    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
