C51 COMPILER V9.00   KEY_MODE                                                              11/07/2018 14:17:31 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE KEY_MODE
OBJECT MODULE PLACED IN .\Objects\Key_Mode.obj
COMPILER INVOKED BY: D:\ProgramFiles\Keil_v5\C51\BIN\C51.EXE App_User\Source\Key_Mode.c OPTIMIZE(8,SPEED) BROWSE INCDIR(
                    -.\Device;.\App_User\Include) DEBUG OBJECTEXTEND PRINT(.\Listings\Key_Mode.lst) OBJECT(.\Objects\Key_Mode.obj)

line level    source

   1          /*******************/
   2          /*Í·ÎÄ¼þheader file*/
   3          /*******************/
   4          #include "app_main.h"
*** ERROR C129 IN LINE 10 OF \HOMEWORK\KEIL5\PROJECT\PROJECT.COMPANY\7¡¢GP-095\GP-095_BT-LED_ALARM\APP_USER\INCLUDE\LED_
             -MODE.H: missing ';' before '|='
   5          
   6          /************************/
   7          /*ºê¶¨Òåmacro definition*/
   8          /************************/
   9          
  10          /*************************/
  11          /*ÀàÐÍ¶¨Òåbyte definition*/
  12          /*************************/
  13          FLAG_KEYSET_TypeDef  TYPE_Flag_KSet;//°´¼üµÄ¹¦ÄÜÉèÖÃ±êÖ¾
  14          
  15          /****************************/
  16          /*±êÖ¾Î»¶¨Òåflags definetion*/
  17          /****************************/
  18          
  19          /*****************************/
  20          /*±äÁ¿¶¨Òåvariable definition*/
  21          /*****************************/
  22          uint8_t  gbKeyPress;//°´¼ü°´ÏÂ
  23          uint8_t  gbKeyNone; //Ã»ÓÐ°´¼ü°´ÏÂ
  24          uint8_t  KeyValue;  //°´¼üÖµ
  25          uint8_t  KeyEvent;  //°´¼üÊÂ¼þ
  26          uint8_t  cntKeyLoop;//¼ÆÊý°´¼üÑ­»·£¬¶Ì°´£¬³¤°´£¬³¬³¤°´µÄ°´ÏÂÊ±¼ä
  27          uint8_t  cntKeylong;
  28          uint8_t  KeyCurValueBK;//ÏÖÔÚ°´¼ü±¸·Ý
  29          uint8_t  KeyCurValue;//°´¼üÏÖÔÚÖµ
  30          uint8_t  KeyLastValue;//°´¼üÉÏÒ»´ÎµÄÖµ
  31          /**************************/
  32          /*Êý×é¶¨Òåarray definition*/
  33          /**************************/
  34          
  35          /******************************/
  36          /*º¯ÊýÉùÃ÷Function declaration*/
  37          /******************************/
  38          
  39          /*****************************/
  40          /*º¯Êý¶¨Òåfunction definetion*/
  41          /*****************************/
  42          /*******************************************************************************
  43           * º¯ÊýÔ­ÐÍ£º
  44           * ÊäÈë²ÎÊý£º
  45           * Êä³ö²ÎÊý£º
  46           * º¯Êý¹¦ÄÜ£º
  47           * ·µ»ØÖµËµÃ÷£º
  48           * ´´½¨ÈÕÆÚ£º
  49           * ´´½¨ÈË£º
  50           * ÐÞ¸ÄÈÕÆÚ
  51           * ÐÞ¸ÄÈË£º
  52           * µÚN´ÎÐÞ¸Ä£º
C51 COMPILER V9.00   KEY_MODE                                                              11/07/2018 14:17:31 PAGE 2   

  53           * ÐÞ¸ÄÔ­Òò£º
  54           * ±¸×¢£º"P1=0x2F(0010_1111)"ÏÈ¸³Öµ¸øP1¿Ú£¬P15Îª1£¬P14Îª0£¬ÊäÈë¶Ë(P10-P13)Îª1£¬
  55           * È»ºóÔÙ¶ÁP1¿ÚµçÆ½(P1&0x0F)£¬²¢°Ñ¸ßËÄÎ»¶¼Çå0£¬¼ÙÈçÕâÊ±ºòP10±»°´ÏÂ£¬ÄÇ¶Áµ½µÄP1
  56           * ¿ÚµçÆ½Îª(P1&0x0f)Îª0x0E(0000_1110),È»ºóÓë0x0F(0000_1111)Òì»òµÃµ½0x01(0000_0001),
  57           * 
  58           *******************************************************************************/
  59          uint8_t  Matrix_Buttons(void)
  60           {
  61                   uint8_t  readData1,readData2;
  62                   uint8_t  keyValue;
  63                   keyValue=0;//Èç¹ûÃ»ÓÐ°´¼ü°´ÏÂ¾ÍÊÇ·µ»Ø0
  64                   
  65                   /*******************************************************************************
  66                   *¹¦ÄÜ£º"P1=0x2F(0010_1111)"ÏÈ¸³Öµ¸øP1¿Ú£¬P15Îª1£¬P14Îª0£¬ÊäÈë¶Ë(P10-P13)Îª1£¬È»
  67                   * ºóÔÙ¶ÁP1¿ÚµçÆ½(P1&0x0F)£¬²¢°Ñ¸ßËÄÎ»¶¼Çå0(P1&0x0F£¬¼ÙÈçÕâÊ±ºòP10±»°´ÏÂ£¬ÄÇ¶Áµ½
  68                   * µÄP1¿ÚµçÆ½Îª0x0E(0000_1110),È»ºóÓë0x0F(0000_1111)Òì»òµÃµ½0x01(0000_0001),
  69                   * readData1µÄ·¶Î§Îª1¡¢2¡¢4¡¢8£¬keyValueµÄ·¶Î§Îª1~8¡£
  70                   *******************************************************************************/
  71                   P1=0x2F;                       
  72                   readData1=(P1&0x0F)^0x0F;
  73                   switch(readData1)
  74                   {
  75                           case 1:
  76                                   keyValue=1; //SNOOZE-PAUSE
  77                                   break;
  78                           case 2:
  79                                   keyValue=2; //VOL+
  80                                   break;
  81                           case 4:
  82                                   keyValue=3; //TIME-DIM
  83                                   break;
  84                           case 8:
  85                                   keyValue=4; //NEXT
  86                                   break;
  87                           default:
  88                                   break;
  89                   }
  90                   /*******************************************************************************
  91                   *¹¦ÄÜ£º"P1=0x1F(0001_1111)"ÏÈ¸³Öµ¸øP1¿Ú£¬P15Îª0£¬P14Îª1£¬ÊäÈë¶Ë(P10-P13)Îª1£¬È»
  92                   * ºóÔÙ¶ÁP1¿ÚµçÆ½(P1&0x0F)£¬²¢°Ñ¸ßËÄÎ»¶¼Çå0(P1&0x0F£¬¼ÙÈçÕâÊ±ºòP11±»°´ÏÂ£¬ÄÇ¶Áµ½
  93                   * µÄP1¿ÚµçÆ½Îª0x0D(0000_1101),È»ºóÓë0x0F(0000_1111)Òì»òµÃµ½0x02(0000_0010),
  94                   * readData2µÄ·¶Î§Îª1¡¢2¡¢4¡¢8£¬keyValueµÄ·¶Î§Îª1~8¡£
  95                   *******************************************************************************/
  96                   P1=0x1F;
  97                   readData2=(P1&0x0F)^0x0F;
  98                   switch(readData2)
  99                   {
 100                           case 1:
 101                                   keyValue=5; //ALARM
 102                                   break;
 103                           case 2:
 104                                   keyValue=6; //VOL-
 105                                   break;
 106                           case 4:
 107                                   keyValue=7; //BT
 108                                   break;
 109                           case 8:
 110                                   keyValue=8; //PREV
 111                                   break;
 112                           default:
 113                                   break;
 114                   }
C51 COMPILER V9.00   KEY_MODE                                                              11/07/2018 14:17:31 PAGE 3   

 115                   
 116                   return keyValue;
 117           }
 118          
 119          /*******************************************************************************
 120           * º¯ÊýÔ­ÐÍ£º
 121           * ÊäÈë²ÎÊý£º
 122           * Êä³ö²ÎÊý£º
 123           * º¯Êý¹¦ÄÜ£º
 124           * ·µ»ØÖµËµÃ÷£º
 125           * ´´½¨ÈÕÆÚ£º
 126           * ´´½¨ÈË£º
 127           * ÐÞ¸ÄÈÕÆÚ
 128           * ÐÞ¸ÄÈË£º
 129           * µÚN´ÎÐÞ¸Ä£º
 130           * ÐÞ¸ÄÔ­Òò£º
 131           * ±¸×¢£º
 132           *******************************************************************************/
 133          uint8_t GetKeyValue(void) 
 134          {
 135                  uint8_t  keyNum;
 136                  keyNum=Matrix_Buttons();
 137                  return keyNum; //·µ»Ø°´¼ü
 138          }
 139          
 140          /*******************************************************************************
 141           * º¯ÊýÔ­ÐÍ£º
 142           * ÊäÈë²ÎÊý£º
 143           * Êä³ö²ÎÊý£º
 144           * º¯Êý¹¦ÄÜ£º
 145           * ·µ»ØÖµËµÃ÷£º
 146           * ´´½¨ÈÕÆÚ£º
 147           * ´´½¨ÈË£º
 148           * ÐÞ¸ÄÈÕÆÚ
 149           * ÐÞ¸ÄÈË£º
 150           * µÚN´ÎÐÞ¸Ä£º
 151           * ÐÞ¸ÄÔ­Òò£º
 152           * ±¸×¢£º
 153           *******************************************************************************/
 154          void KeyEventPorc(uint8_t KeyTmp) //±»µ÷ÓÃÊ±½ÓÊÕµÄÊÇGetKeyValue()µÄ·µ»ØÖµ  Ò»°ã¹Ì¶¨£¬²»¸ü¸Ä
 155          {
 156                  gbKeyPress=0;
 157                  if(KeyCurValue!=KeyTmp) //Õâ¸öifÓï¾äÊÇÈ¥¶¶£¬»á±»Ö´ÐÐÁ½´Î£¬µÚÈý´Î½øÀ´Ê±Ö±½ÓÌø¹ý
 158                  {//KeyTmpÎªÁÙÊ±Öµ£¬
 159                          if(KeyCurValueBK!=KeyTmp)
 160                                  KeyCurValueBK=KeyTmp;
 161                          else //µÚ¶þ´Î½øÀ´Ê±Ö´ÐÐÕâÒ»Ìõ
 162                                  KeyCurValue=KeyTmp; //
 163                          return;
 164                  }
 165                  if(KeyCurValue==KeyLastValue)
 166                  {
 167                          if((KeyLastValue==0) || (cntKeyLoop==0))
 168                                  return;
 169                          if(--cntKeyLoop==0) //Õâ¸öÔÚµÚ¶þ´Î½øKeyEventPorc()º¯Êý£¨µÚÒ»´Î½ø¡°if(KeyCurValue==KeyLastValue)¡±Ö®Ç°£©Ê
             -±±»ÏÂÃæ¸³ÖµÎª5
 170                          { //cntKeyLoopÎª5¾ÍÊÇ50msÊ±¼ä
 171                                  KeyValue=KeyLastValue; //·À¶¶Ö®ºó°ÑÈ·¶¨µÄ°´¼ü¸³Öµ¸øKeyValue
 172                                  if(gbKeyNone==0)
 173                                          gbKeyPress=1;
 174                                  switch(KeyEvent)
 175                                  {
C51 COMPILER V9.00   KEY_MODE                                                              11/07/2018 14:17:31 PAGE 4   

 176                                          case 0:
 177                                                  KeyEvent=1;
 178                                                  KeyValue |= K_D;
 179                                                  cntKeyLoop=cKEY_HOLD;
 180                                                  break;
 181                                          case 1:
 182                                                  KeyEvent=2;
 183                                                  KeyValue |= K_H;
 184                                                  cntKeyLoop=cKEY_RATE_VOL;
 185                                                  break;
 186                                                  case 2:
 187                                          case 3:
 188                                                  KeyEvent=3;
 189                                                  KeyValue |= K_R;
 190                                                  cntKeyLoop=cKEY_RATE_VOL;
 191                                                  if(cntKeylong<250)
 192                                                          cntKeylong++;
 193                                                  break;
 194                                  }
 195                          }
 196                  }
 197                  else
 198                  {
 199                          if(KeyLastValue)
 200                          {
 201                                  KeyValue=KeyLastValue;
 202                                  if(gbKeyNone==0)
 203                                          gbKeyPress=1;
 204                                  switch(KeyEvent)
 205                                  {
 206                                          case 1:KeyValue |= K_U; break;
 207                                          case 2:KeyValue |= K_LU;break;
 208                                          case 3:KeyValue |= K_LU;break;
 209                                  }
 210                                  KeyEvent=0;
 211                          }
 212                          else
 213                          {
 214                                  gbKeyNone=0;
 215                                  cntKeylong=0;
 216                          }
 217                          cntKeyLoop=cKEY_CLICK;
 218                          KeyLastValue=KeyCurValue;
 219                  }
 220          }
 221          
 222          /*******************************************************************************
 223           * º¯ÊýÔ­ÐÍ£º
 224           * ÊäÈë²ÎÊý£º
 225           * Êä³ö²ÎÊý£º
 226           * º¯Êý¹¦ÄÜ£º
 227           * ·µ»ØÖµËµÃ÷£º
 228           * ´´½¨ÈÕÆÚ£º
 229           * ´´½¨ÈË£º
 230           * ÐÞ¸ÄÈÕÆÚ
 231           * ÐÞ¸ÄÈË£º
 232           * µÚN´ÎÐÞ¸Ä£º
 233           * ÐÞ¸ÄÔ­Òò£º
 234           * ±¸×¢£º
 235           *******************************************************************************/
 236          void KeyScan(void) //±»Ö÷º¯Êýµ÷ÓÃ
 237          {
C51 COMPILER V9.00   KEY_MODE                                                              11/07/2018 14:17:31 PAGE 5   

 238                  KeyEventPorc(GetKeyValue());
 239          }
 240           
 241           /*******************************************************************************
 242           * º¯ÊýÔ­ÐÍ£º
 243           * ÊäÈë²ÎÊý£º
 244           * Êä³ö²ÎÊý£º
 245           * º¯Êý¹¦ÄÜ£º
 246           * ·µ»ØÖµËµÃ÷£º
 247           * ´´½¨ÈÕÆÚ£º
 248           * ´´½¨ÈË£º
 249           * ÐÞ¸ÄÈÕÆÚ
 250           * ÐÞ¸ÄÈË£º
 251           * µÚN´ÎÐÞ¸Ä£º
 252           * ÐÞ¸ÄÔ­Òò£º
 253           * ±¸×¢£º2.¡¢³¤°´¡°TIME¡±¼ü2S£¬Ð¡Ê±×Ö·ûÉÁË¸£¬¶Ì°´¡°VOL-/PREV¡±¼ü£¬Ð¡Ê±µÝ¼õ£¬³¤°´
 254           * ¡°VOL-/PREV¡±¼ü£¬Ð¡Ê±¿ìËÙµÝ¼õ£»¶Ì°´¡°VOL+/NEXT¡±¼ü£¬Ð¡Ê±µÝÔö£¬³¤°´¡°VOL+/NEXT¡±¼ü£¬
 255           * Ð¡Ê±¿ìËÙµÝÔö¡£
 256           * 3¡¢¶Ì°´¡°TIME¡±¼ü£¬·Ö×Ö·ûÉÁË¸£¬¶Ì°´¡°VOL-/PREV¡±¼ü£¬·ÖÎ»ÊýµÝ¼õ£¬³¤°´¡°VOL-/PREV¡±¼ü£¬
 257           * ·ÖÎ»Êý¿ìËÙµÝ¼õ£»¶Ì°´¡°VOL+/NEXT¡±¼ü£¬·ÖÎ»ÊýµÝÔö£¬³¤°´¡°VOL+/NEXT¡±¼ü£¬·ÖÎ»Êý¿ìËÙµÝ
 258           * Ôö¡£
 259           * 4¡¢ÔÚ×ßÊ±Ä£Ê½ÏÂ£¬¶Ì°´¡°TIME/DIM¡±¼ü£¬µ÷ÕûÏÔÊ¾ÁÁ¶È£¬¿ÉÑ­»·µ÷Õû¸ß¡¢ÖÐ¡¢µÍÁÁ£¨Ä¬ÈÏ
 260           * Îª¸ßÁÁ£©
 261           *******************************************************************************/
 262          void KeyComMsg(void) 
 263          {
 264                  if(gbKeyPress)
 265                  { 
 266                          //Flag_data_bk=1;//Êý¾Ý¸Ä±äÊ±±¸·Ý
 267                          switch(KeyValue)
 268                          {
 269                                  case KU(K_SNOOZE_PAUSE)://¶Ì°´
 270                                  {
 271                                          
 272                                          break;
 273                                  }
 274                                  case KH(K_SNOOZE_PAUSE)://³¤°´
 275                                  {
 276                                          
 277                                          break;
 278                                  }
 279                                  case KU(K_VOLINC): //¶Ì°´//ÒôÁ¿¼Ó 
 280                                  case KR(K_VOLINC): //³¤°´//ÒôÁ¿¼Ó
 281                                  {
 282                                          //³¤°´¡°VOL+/NEXT¡±¼ü£¬Ð¡Ê±¿ìËÙµÝÔö¡£
 283                                          //³¤°´¡°VOL+/NEXT¡±¼ü£¬·ÖÖÓÎ»Êý¿ìËÙµÝÔö¡£
 284                                          if ((TYPE_Flag_KSet == FLAG_KEYSET_JUST_POWER_LONG_TIME) && (TYPE_Play_Mode == PLAY_JUST_POWER))
 285                                          {
 286                                                  if (gRTC_Hour < 12)
 287                                                  {
 288                                                          gRTC_Hour++;
 289                                                  }
 290                                          }
 291                                          else if ((TYPE_Flag_KSet == FLAG_KEYSET_JUST_POWER_SHORT_TIME) && (TYPE_Play_Mode == PLAY_JUST_POWER))
 292                                          {
 293                                                  if (gRTC_Minute < 59)
 294                                                  {
 295                                                          gRTC_Minute++;
 296                                                  }
 297                                          }
 298                                          else if (TYPE_Flag_KSet == FLAG_KEYSET_LONG_ALARM_HOUR)
 299                                          {
C51 COMPILER V9.00   KEY_MODE                                                              11/07/2018 14:17:31 PAGE 6   

 300                                                  if (TYPE_Alarm1.tempHour < 12)
 301                                                  {
 302                                                          TYPE_Alarm1.tempHour++;
 303                                                  }
 304                                          }
 305                                          else if (TYPE_Flag_KSet == FLAG_KEYSET_SHORT_ALARM_MINUTE)
 306                                          {
 307                                                  if (TYPE_Alarm1.tempMinute < 59)
 308                                                  {
 309                                                          TYPE_Alarm1.tempMinute++;
 310                                                  }
 311                                          }
 312                                          else if (TYPE_Flag_KSet == FLAG_KEYSET_SHORT_ALARM_ALMODE)
 313                                          {
 314                                                  if (TYPE_Alarm1.Alarm_Mode == ALARM_BEEP)
 315                                                  {
 316                                                          TYPE_Alarm1.Alarm_Mode = ALARM_BT;
 317                                                  }
 318                                                  else
 319                                                  {
 320                                                          TYPE_Alarm1.Alarm_Mode = ALARM_BEEP;
 321                                                  }
 322                                          }
 323          
 324                                          if (TYPE_Play_Mode == PLAY_IN_TIME)//ÔÚ×ßÊ±Ä£Ê½ÏÂÀ¶ÑÀ×´Ì¬ºÍTF¿¨
 325                                          {
 326                                                  if (sys_Volume < 15)
 327                                                  {
 328                                                          sys_Volume++;
 329                                                  }
 330                                          }
 331                                          break;
 332                                  }
 333                                  case KU(K_TIME_DIM): //¶Ì°´//¶Ì°´·ÖÖÓ×Ö·ûÉÁË¸£¬
 334                                  {                                       
 335                                          if (TYPE_Play_Mode == PLAY_JUST_POWER)
 336                                          {
 337                                                  TYPE_Flag_KSet = FLAG_KEYSET_JUST_POWER_SHORT_TIME;
 338                                          }
 339                                          else if (TYPE_Play_Mode == PLAY_IN_TIME)
 340                                          {
 341                                                  TYPE_LED_Brightness--;
 342                                                  if (TYPE_LED_Brightness == LED_TURN_OFF)//ÈýÖÖÁÁ¶ÈÐÎ³ÉÑ­»·
 343                                                  {
 344                                                          TYPE_LED_Brightness = LED_HIGH;
 345                                                  }
 346                                          }
 347                                          //¶Ì°´¡°TIME/DIM¡±¼ü£¬µ÷ÕûÏÔÊ¾ÁÁ¶È£¬¿ÉÑ­»·µ÷Õû¸ß¡¢ÖÐ¡¢µÍÁÁ£¨Ä¬ÈÏÎª¸ßÁÁ£©
 348                                          break;
 349                                  }
 350                                  case KR(K_TIME_DIM): //¼ÆÊ±
 351                                  {
 352                                          if (TYPE_Play_Mode == PLAY_JUST_POWER)
 353                                          {
 354                                                  if (cntKeylong == 10)//³¤°´2sÐ¡Ê±×Ö·ûÉÁË¸
 355                                                  {
 356                                                          TYPE_Flag_KSet = FLAG_KEYSET_JUST_POWER_LONG_TIME;
 357                                                  }
 358                                          }
 359                                          break;
 360                                  }
 361                                  case KU(K_NEXT): //¶Ì°´
C51 COMPILER V9.00   KEY_MODE                                                              11/07/2018 14:17:31 PAGE 7   

 362                                  case KR(K_NEXT): //³¤°´
 363                                  {
 364                                          //³¤°´¡°VOL+/NEXT¡±¼ü£¬Ð¡Ê±¿ìËÙµÝÔö¡£
 365                                          //³¤°´¡°VOL+/NEXT¡±¼ü£¬·ÖÖÓÎ»Êý¿ìËÙµÝÔö¡£
 366                                          if ((TYPE_Flag_KSet == FLAG_KEYSET_JUST_POWER_LONG_TIME) && (TYPE_Play_Mode == PLAY_JUST_POWER))
 367                                          {
 368                                                  if (gRTC_Hour < 12)
 369                                                  {
 370                                                          gRTC_Hour++;
 371                                                  }
 372                                          }
 373                                          else if ((TYPE_Flag_KSet == FLAG_KEYSET_JUST_POWER_SHORT_TIME) && (TYPE_Play_Mode == PLAY_JUST_POWER))
 374                                          {
 375                                                  if (gRTC_Minute < 59)
 376                                                  {
 377                                                          gRTC_Minute++;
 378                                                  }
 379                                          }
 380                                          else if (TYPE_Flag_KSet == FLAG_KEYSET_LONG_ALARM_HOUR)
 381                                          {
 382                                                  if (TYPE_Alarm1.tempHour < 12)
 383                                                  {
 384                                                          TYPE_Alarm1.tempHour++;
 385                                                  }
 386                                          }
 387                                          else if (TYPE_Flag_KSet == FLAG_KEYSET_SHORT_ALARM_MINUTE)
 388                                          {
 389                                                  if (TYPE_Alarm1.tempMinute < 59)
 390                                                  {
 391                                                          TYPE_Alarm1.tempMinute++;
 392                                                  }
 393                                          }
 394                                          else if (TYPE_Flag_KSet == FLAG_KEYSET_SHORT_ALARM_ALMODE)
 395                                          {
 396                                                  if (TYPE_Alarm1.Alarm_Mode == ALARM_BEEP)
 397                                                  {
 398                                                          TYPE_Alarm1.Alarm_Mode = ALARM_BT;
 399                                                  }
 400                                                  else
 401                                                  {
 402                                                          TYPE_Alarm1.Alarm_Mode = ALARM_BEEP;
 403                                                  }
 404                                          }
 405                                          break;
 406                                  }
 407                                  case KU(K_ALARM): //¶Ì°´//ÄÖÖÓ
 408                                  {
 409                                          //¶Ì°´¡°VOL+/NEXT¡±¼ü£¬Ð¡Ê±µÝÔö£¬
 410                                          //¶Ì°´¡°VOL+/NEXT¡±¼ü£¬·ÖÖÓÎ»ÊýµÝÔö£¬
 411                                          if (TYPE_Play_Mode == PLAY_IN_TIME)
 412                                          {
 413                                                  //Ê×ÏÈÏÔÊ¾ALARMÊ±¼ä£¬ÏÖÔÚ»¹Ã»ÓÐÐ´£¬¿ÉÒÔÐ´¸öº¯Êý
 414                                                  TYPE_Alarm1.enable = 1;//´ò¿ªÄÖÖÓ
 415                                          }
 416                                          if (TYPE_Flag_KSet == FLAG_KEYSET_LONG_ALARM_HOUR)
 417                                          {
 418                                                  //ÒªÏÈ³¤°´ALARM¼ü2s£¬ÔÙ¶Ì°´ALARM¼ü½øÈë´Ëif¹¦ÄÜ£¬ÎªÉèÖÃÄÖÖÓ·ÖÖÓÊ±¼ä
 419                                                  TYPE_Flag_KSet = FLAG_KEYSET_SHORT_ALARM_MINUTE;
 420                                          }
 421                                          else if (TYPE_Flag_KSet == FLAG_KEYSET_SHORT_ALARM_MINUTE)
 422                                          {
 423                                                  //ÒªÏÈ¶Ì°´ALARM¼ü½øÈëÉèÖÃÄÖÖÓÅª·ÖÖÓ¹¦ÄÜ£¬ÔÙ¶Ì°´ALARM¼ü½øÈë´Ëelse-if¹¦ÄÜ£¬ÎªÑ¡ÔñÏìÄÖÄ£Ê½
C51 COMPILER V9.00   KEY_MODE                                                              11/07/2018 14:17:31 PAGE 8   

 424                                                  TYPE_Flag_KSet = FLAG_KEYSET_SHORT_ALARM_ALMODE;
 425                                                  TYPE_Alarm1.Flag_Confirm_TimeCnt_30Sec = 2;//¶Ì°´ALARM¼üÈ·ÈÏÉèÖÃ»ò²»¶¯×÷30s×Ô¶¯±£´æ£¬(Îª1
 426                                                                                                                                     //ÊÇÈ·ÈÏÄÖÖÓÉèÖÃ±êÖ¾Î»)Îª2ÊÇ30s¼ÆÊ±±êÖ¾Î»£¬
 427                                                  timeCnt_30Sec = 0;
 428                                          }
 429                                          else if (TYPE_Flag_KSet == FLAG_KEYSET_SHORT_ALARM_ALMODE)
 430                                          {
 431                                                  //ÒªÏÈ¶Ì°´ALARM¼ü½øÈëÑ¡ÔñÄÖÖÓÏìÄÖÄ£Ê½£¬ÔÙ¶Ì°´ALARM¼ü½øÈë´Ëelse-if¹¦ÄÜ£¬ÎªÈ·ÈÏÄÖÖÓÉèÖÃ»ò
 432                                                  //²»¶¯×÷30s×Ô¶¯±£´æ£¬²¢·µ»Ø×ßÊ±Ä£Ê½£¬ÏìÄÖÊ±¼ä60min
 433                                                  //TYPE_Alarm1.Flag_Confirm_TimeCnt_30Sec = 1;//¶Ì°´ALARM¼üÈ·ÈÏÉèÖÃ»ò²»¶¯×÷30s×Ô¶¯±£´æ£¬(Îª1
 434                                                                                                                                     //ÊÇÈ·ÈÏÄÖÖÓÉèÖÃ±êÖ¾Î»)Îª2ÊÇ30s¼ÆÊ±±êÖ¾Î»£¬
 435                                                  TYPE_Alarm1.hour=TYPE_Alarm1.tempHour;    //Ö±½ÓÈ·ÈÏ°ÑÁÙÊ±µÄalarmÊ±¼ä±äÁ¿¸³¸øÓëRTCÊ±ÖÓ¶Ô±ÈµÄ±äÁ¿
 436                                                  TYPE_Alarm1.minute=TYPE_Alarm1.tempMinute;
 437                                                  timeCnt_30Sec = 0;
 438                                          }
 439                                          break;
 440                                  }
 441                                  case KH(K_ALARM): //³¤°´//ÄÖÖÓ
 442                                  {
 443                                          //³¤°´¡°VOL+/NEXT¡±¼ü£¬Ð¡Ê±¿ìËÙµÝÔö¡£
 444                                          //³¤°´¡°VOL+/NEXT¡±¼ü£¬·ÖÖÓÎ»Êý¿ìËÙµÝÔö¡£
 445                                          if (TYPE_Play_Mode == PLAY_IN_TIME)
 446                                          {
 447                                                  if (cntKeylong > 10)
 448                                                  {
 449                                                          //Í¬Ê±×Ö·ûÉÁË¸£¬»¹Ã»ÓÐÐ´
 450                                                          TYPE_Play_Mode = PLAY_ALARM;
 451                                                          TYPE_Flag_KSet = FLAG_KEYSET_LONG_ALARM_HOUR;//ÎªÉèÖÃÄÖÖÓÐ¡Ê±Ê±¼ä
 452                                                  }
 453                                          }
 454                                          break;
 455                                  }
 456                                  case KU(K_VOLDEC): //¶Ì°´//ÒôÁ¿¼õ
 457                                  case KR(K_VOLDEC): //³¤°´//ÒôÁ¿¼õ
 458                                  {
 459                                          //³¤°´¡°VOL-/PREV¡±¼ü£¬Ð¡Ê±¿ìËÙµÝ¼õ£»
 460                                          //³¤°´¡°VOL-/PREV¡±¼ü£¬·ÖÖÓÎ»Êý¿ìËÙµÝ¼õ£»
 461                                          if ((TYPE_Flag_KSet == FLAG_KEYSET_JUST_POWER_LONG_TIME) && (TYPE_Play_Mode == PLAY_JUST_POWER))
 462                                          {
 463                                                  if (gRTC_Hour > 0)
 464                                                  {
 465                                                          gRTC_Hour--;
 466                                                  }
 467                                          }
 468                                          else if ((TYPE_Flag_KSet == FLAG_KEYSET_JUST_POWER_SHORT_TIME) && (TYPE_Play_Mode == PLAY_JUST_POWER))
 469                                          {
 470                                                  if (gRTC_Minute > 0)
 471                                                  {
 472                                                          gRTC_Minute--;
 473                                                  }
 474                                          }
 475                                          else if (TYPE_Flag_KSet == FLAG_KEYSET_LONG_ALARM_HOUR)
 476                                          {
 477                                                  if (TYPE_Alarm1.tempHour > 0)
 478                                                  {
 479                                                          TYPE_Alarm1.tempHour--;
 480                                                  }
 481                                          }
 482                                          else if (TYPE_Flag_KSet == FLAG_KEYSET_SHORT_ALARM_MINUTE)
 483                                          {
 484                                                  if (TYPE_Alarm1.tempMinute > 0)
 485                                                  {
C51 COMPILER V9.00   KEY_MODE                                                              11/07/2018 14:17:31 PAGE 9   

 486                                                          TYPE_Alarm1.tempMinute--;
 487                                                  }
 488                                          }
 489                                          else if (TYPE_Flag_KSet == FLAG_KEYSET_SHORT_ALARM_ALMODE)
 490                                          {
 491                                                  if (TYPE_Alarm1.Alarm_Mode == ALARM_BEEP)
 492                                                  {
 493                                                          TYPE_Alarm1.Alarm_Mode = ALARM_BT;
 494                                                  }
 495                                                  else
 496                                                  {
 497                                                          TYPE_Alarm1.Alarm_Mode = ALARM_BEEP;
 498                                                  }
 499                                          }
 500          
 501                                          if (TYPE_Play_Mode == PLAY_IN_TIME)//ÔÚ×ßÊ±Ä£Ê½ÏÂÀ¶ÑÀ×´Ì¬ºÍTF¿¨
 502                                          {
 503                                                  if (sys_Volume > 0)
 504                                                  {
 505                                                          sys_Volume--;
 506                                                  }
 507                                          }
 508                                          break;
 509                                  }
 510                                  case KU(K_BT): //¶Ì°´
 511                                  {
 512                                          //¶Ì°´¡°VOL-/PREV¡±¼ü£¬Ð¡Ê±µÝ¼õ£¬
 513                                          //¶Ì°´¡°VOL-/PREV¡±¼ü£¬·ÖÖÓÎ»ÊýµÝ¼õ£¬
 514                                          if (TYPE_Play_Mode != PLAY_IN_TIME_BT)
 515                                          {
 516                                                  TYPE_Play_Mode = PLAY_IN_TIME_BT;
 517                                          }
 518                                          break;
 519                                  }
 520                                  case KH(K_BT): //³¤°´
 521                                  {
 522                                          //³¤°´¡°VOL-/PREV¡±¼ü£¬Ð¡Ê±¿ìËÙµÝ¼õ£»
 523                                          //³¤°´¡°VOL-/PREV¡±¼ü£¬·ÖÖÓÎ»Êý¿ìËÙµÝ¼õ£»
 524                                          break;
 525                                  }
 526                                  case KU(K_PREV): //¶Ì°´
 527                                  case KR(K_PREV): //³¤°´
 528                                  {
 529                                          //³¤°´¡°VOL-/PREV¡±¼ü£¬Ð¡Ê±¿ìËÙµÝ¼õ£»
 530                                          //³¤°´¡°VOL-/PREV¡±¼ü£¬·ÖÖÓÎ»Êý¿ìËÙµÝ¼õ£»
 531                                          if ((TYPE_Flag_KSet == FLAG_KEYSET_JUST_POWER_LONG_TIME) && (TYPE_Play_Mode == PLAY_JUST_POWER))
 532                                          {
 533                                                  if (gRTC_Hour > 0)
 534                                                  {
 535                                                          gRTC_Hour--;
 536                                                  }
 537                                          }
 538                                          else if ((TYPE_Flag_KSet == FLAG_KEYSET_JUST_POWER_SHORT_TIME) && (TYPE_Play_Mode == PLAY_JUST_POWER))
 539                                          {
 540                                                  if (gRTC_Minute > 0)
 541                                                  {
 542                                                          gRTC_Minute--;
 543                                                  }
 544                                          }
 545                                          else if (TYPE_Flag_KSet == FLAG_KEYSET_LONG_ALARM_HOUR)
 546                                          {
 547                                                  if (TYPE_Alarm1.tempHour > 0)
C51 COMPILER V9.00   KEY_MODE                                                              11/07/2018 14:17:31 PAGE 10  

 548                                                  {
 549                                                          TYPE_Alarm1.tempHour--;
 550                                                  }
 551                                          }
 552                                          else if (TYPE_Flag_KSet == FLAG_KEYSET_SHORT_ALARM_MINUTE)
 553                                          {
 554                                                  if (TYPE_Alarm1.tempMinute > 0)
 555                                                  {
 556                                                          TYPE_Alarm1.tempMinute--;
 557                                                  }
 558                                          }
 559                                          else if (TYPE_Flag_KSet == FLAG_KEYSET_SHORT_ALARM_ALMODE)
 560                                          {
 561                                                  if (TYPE_Alarm1.Alarm_Mode == ALARM_BEEP)
 562                                                  {
 563                                                          TYPE_Alarm1.Alarm_Mode = ALARM_BT;
 564                                                  }
 565                                                  else
 566                                                  {
 567                                                          TYPE_Alarm1.Alarm_Mode = ALARM_BEEP;
 568                                                  }
 569                                          }
 570                                          break;
 571                                  }
 572                                  
 573                                  
 574                          }
 575                  }
 576          }
 577          
 578          
 579          
 580          
 581           
 582           /*******************************************************************************
 583           * º¯ÊýÔ­ÐÍ£º
 584           * ÊäÈë²ÎÊý£º
 585           * Êä³ö²ÎÊý£º
 586           * º¯Êý¹¦ÄÜ£º
 587           * ·µ»ØÖµËµÃ÷£º
 588           * ´´½¨ÈÕÆÚ£º
 589           * ´´½¨ÈË£º
 590           * ÐÞ¸ÄÈÕÆÚ
 591           * ÐÞ¸ÄÈË£º
 592           * µÚN´ÎÐÞ¸Ä£º
 593           * ÐÞ¸ÄÔ­Òò£º
 594           * ±¸×¢£º
 595           *******************************************************************************/
 596           
 597           
 598           /*******************************************************************************
 599           * º¯ÊýÔ­ÐÍ£º
 600           * ÊäÈë²ÎÊý£º
 601           * Êä³ö²ÎÊý£º
 602           * º¯Êý¹¦ÄÜ£º
 603           * ·µ»ØÖµËµÃ÷£º
 604           * ´´½¨ÈÕÆÚ£º
 605           * ´´½¨ÈË£º
 606           * ÐÞ¸ÄÈÕÆÚ
 607           * ÐÞ¸ÄÈË£º
 608           * µÚN´ÎÐÞ¸Ä£º
 609           * ÐÞ¸ÄÔ­Òò£º
C51 COMPILER V9.00   KEY_MODE                                                              11/07/2018 14:17:31 PAGE 11  

 610           * ±¸×¢£º
 611           *******************************************************************************/
 612          
 613          
 614          
 615          
 616          
 617          
 618          
 619          
 620          
 621          
 622          
 623          
 624          
 625          
 626          

C51 COMPILATION COMPLETE.  0 WARNING(S),  1 ERROR(S)
