C51 COMPILER V9.00   APP_MAIN                                                              11/07/2018 14:17:31 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE APP_MAIN
OBJECT MODULE PLACED IN .\Objects\app_main.obj
COMPILER INVOKED BY: D:\ProgramFiles\Keil_v5\C51\BIN\C51.EXE App_User\Source\app_main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(
                    -.\Device;.\App_User\Include) DEBUG OBJECTEXTEND PRINT(.\Listings\app_main.lst) OBJECT(.\Objects\app_main.obj)

line level    source

   1          /*******************/
   2          /*头文件header file*/
   3          /*******************/
   4          #include "app_main.h"
*** ERROR C129 IN LINE 10 OF \HOMEWORK\KEIL5\PROJECT\PROJECT.COMPANY\7、GP-095\GP-095_BT-LED_ALARM\APP_USER\INCLUDE\LED_
             -MODE.H: missing ';' before '|='
   5          
   6          /************************/
   7          /*宏定义macro definition*/
   8          /************************/
   9          
  10          /*************************/
  11          /*类型定义byte definition*/
  12          /*************************/
  13          PLAY_MODE_TypeDef  TYPE_Play_Mode;
  14          ALRAM_TypeDef  TYPE_Alarm1;
  15          
  16          /****************************/
  17          /*标志位定义flags definetion*/
  18          /****************************/
  19          bit  AppTick0;
  20          bit  AppTick1;
  21          bit  AppTick2;
  22          bit  AppTick3;
  23          bit  AppTick4;
  24          bit  AppTick5;
  25          bit  AppTick1ms;
  26          
  27          /*****************************/
  28          /*变量定义variable definition*/
  29          /*****************************/
  30          uint8_t  idata cntAppTick;
  31          bit                        gbHalfSecong;
  32          uint8_t  idata gRTC_Sec;//RTC数据 
  33          uint8_t  idata gRTC_Sec_bk;
  34          uint8_t  idata gRTC_Minute;
  35          uint8_t  idata gRTC_Minute_bk;
  36          uint8_t  idata gRTC_Hour;
  37          uint8_t  idata gRTC_Hour_bk;
  38          uint8_t  xdata gRTC_Hour_bk_24;//计数24小时
  39          uint8_t  idata gRTC_Week; //一周7天
  40          uint8_t  idata sys_Volume;
  41          uint16_t idata timeCnt_30Sec;//短按ALARM键缺人设置或不动作30s自动保存，30s计时
  42          
  43          /**************************/
  44          /*数组定义array definition*/
  45          /**************************/
  46          
  47          /******************************/
  48          /*函数声明Function declaration*/
  49          /******************************/
  50          
  51          /*****************************/
  52          /*函数定义function definetion*/
C51 COMPILER V9.00   APP_MAIN                                                              11/07/2018 14:17:31 PAGE 2   

  53          /*****************************/
  54          /*******************************************************************************
  55           * 函数原型：
  56           * 输入参数：
  57           * 输出参数：
  58           * 函数功能：时间比较，把RTC时间与某个定时时间比较，比如闹钟
  59           * 返回值说明：
  60           * 创建日期：
  61           * 创建人：
  62           * 修改日期
  63           * 修改人：
  64           * 第N次修改：
  65           * 修改原因：
  66           * 备注：
  67           *******************************************************************************/
  68          void Compare_1MinutePorc(void)
  69          {
  70                  //static uint8_t  cntSetVolume; //此变量只在上电时初始化一次，再调用此函数时不会执行此语句
  71                  if(gRTC_Sec!=gRTC_Sec_bk)
  72                  {
  73                          gRTC_Sec_bk=gRTC_Sec;
  74                          
  75                          if(gRTC_Minute!=gRTC_Minute_bk)
  76                          {
  77                                  gRTC_Minute_bk=gRTC_Minute;
  78                                  if((TYPE_Alarm1.enable == 1) && (gRTC_Hour == TYPE_Alarm1.hour) && (gRTC_Minute == TYPE_Alarm1.minute))
  79                                  {
  80                                          if(TYPE_Alarm1.Alarm_Mode==ALARM_BT)
  81                                          {
  82                                                  
  83                                          }
  84                                          else
  85                                          {
  86          
  87                                          }
  88                                  }
  89                                          
  90                                  if(gRTC_Hour!=gRTC_Hour_bk)
  91                                  {
  92                                          gRTC_Hour_bk=gRTC_Hour_bk;
  93                                          gRTC_Hour_bk_24++;
  94                                          if(gRTC_Hour_bk_24>=24)
  95                                          {
  96                                                  gRTC_Hour_bk_24=0;
  97                                                  
  98                                          }
  99                                  }
 100                          }
 101                  }
 102          }
 103          
 104          /*******************************************************************************
 105           * 函数原型：
 106           * 输入参数：
 107           * 输出参数：
 108           * 函数功能：其他程序需要用到的计时放在这里进行
 109           * 返回值说明：
 110           * 创建日期：
 111           * 创建人：
 112           * 修改日期
 113           * 修改人：
 114           * 第N次修改：
C51 COMPILER V9.00   APP_MAIN                                                              11/07/2018 14:17:31 PAGE 3   

 115           * 修改原因：
 116           * 备注：
 117           *******************************************************************************/
 118          void Timing_Handle(void)
 119          {
 120                  if (TYPE_Alarm1.Flag_Confirm_TimeCnt_30Sec == 2)
 121                  {
 122                          timeCnt_30Sec++;
 123                          if (timeCnt_30Sec >= 3000)
 124                          {
 125                                  TYPE_Alarm1.Flag_Confirm_TimeCnt_30Sec = 0;
 126                                  timeCnt_30Sec = 0;
 127                                  TYPE_Alarm1.hour = TYPE_Alarm1.tempHour;//30s计时结束把设定的闹钟时间赋给与RTC比对的闹钟变量
 128                                  TYPE_Alarm1.minute = TYPE_Alarm1.tempMinute;
 129                          }
 130                  }
 131                  else
 132                          timeCnt_30Sec = 0;
 133          }
 134          
 135          /*******************************************************************************
 136           * 函数原型：
 137           * 输入参数：
 138           * 输出参数：
 139           * 函数功能：
 140           * 返回值说明：
 141           * 创建日期：
 142           * 创建人：
 143           * 修改日期
 144           * 修改人：
 145           * 第N次修改：
 146           * 修改原因：
 147           * 备注：
 148           *******************************************************************************/
 149          void Sys_Tick(void)
 150          {
 151                  AppTick1ms=1;
 152                  if(cntAppTick==0)
 153                          AppTick0=1;
 154                  if(cntAppTick==1)
 155                          AppTick1=1;
 156                  if(cntAppTick==2)
 157                          AppTick2=1;
 158                  if(cntAppTick==3)
 159                          AppTick3=1;
 160                  if(cntAppTick==4)
 161                          AppTick4=1;
 162                  if(cntAppTick==5)
 163                          AppTick5=1;
 164                  if(cntAppTick==6)
 165                  {
 166                  
 167                  }
 168                  if(++cntAppTick>=10)
 169                          cntAppTick=0;
 170          }
 171          
 172          /*******************************************************************************
 173           * 函数原型：
 174           * 输入参数：
 175           * 输出参数：
 176           * 函数功能：
C51 COMPILER V9.00   APP_MAIN                                                              11/07/2018 14:17:31 PAGE 4   

 177           * 返回值说明：
 178           * 创建日期：
 179           * 创建人：
 180           * 修改日期
 181           * 修改人：
 182           * 第N次修改：
 183           * 修改原因：
 184           * 备注：
 185           *******************************************************************************/
 186          void PowerON_Reset(void)
 187          {
 188                  TYPE_Play_Mode=PLAY_JUST_POWER;//刚上电，模式设为刚上电模式
 189                  TYPE_LED_Brightness=LED_HIGH;//亮度默认为高
 190                  TYPE_Alarm1.Alarm_Mode=ALARM_BEEP; //自己加的为闹钟响闹模式为beep模式，方便写程序，也防止使用者在设置闹钟
 191                                                                          //时没有选择模式，那就选择默认是beep模式
 192          }
 193          
 194          /*******************************************************************************
 195           * 函数原型：
 196           * 输入参数：
 197           * 输出参数：
 198           * 函数功能：
 199           * 返回值说明：
 200           * 创建日期：
 201           * 创建人：
 202           * 修改日期
 203           * 修改人：
 204           * 第N次修改：
 205           * 修改原因：
 206           * 备注：
 207           *******************************************************************************/
 208          void app_main(void)
 209          {
 210                  PowerON_Reset();
 211                  while(1)
 212                  {
 213                          if(AppTick1ms)
 214                          {
 215                                  AppTick1ms=0;
 216                          }
 217                          if(AppTick0)
 218                          {
 219                                  AppTick0=0;
 220                                  KeyScan();
 221                                  KeyComMsg();
 222                          }
 223                          if(AppTick1)
 224                          {
 225                                  AppTick1=0;
 226                                  
 227                          }
 228                          if(AppTick2)
 229                          {
 230                                  AppTick2=0;
 231                                  
 232                          }
 233                          if(AppTick3)
 234                          {
 235                                  AppTick3=0;
 236                                  
 237                          }
 238                          if(AppTick4)
C51 COMPILER V9.00   APP_MAIN                                                              11/07/2018 14:17:31 PAGE 5   

 239                          {
 240                                  AppTick4=0;
 241                                  
 242                          }
 243                          if(AppTick5)
 244                          {
 245                                  AppTick5=0;
 246                                  Timing_Handle();
 247                                  Compare_1MinutePorc();
 248                          }
 249                          WDT_clear();    
 250                  }
 251          }
 252          
 253          
 254          
 255          
 256          
 257          
 258          
 259          
 260          
 261          

C51 COMPILATION COMPLETE.  0 WARNING(S),  1 ERROR(S)
