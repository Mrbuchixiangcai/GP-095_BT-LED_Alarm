C51 COMPILER V9.00   KEY_MODE                                                              11/24/2018 11:03:41 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE KEY_MODE
OBJECT MODULE PLACED IN .\Objects\Key_Mode.obj
COMPILER INVOKED BY: D:\ProgramFiles\Keil_v5\C51\BIN\C51.EXE App_User\Source\Key_Mode.c OPTIMIZE(8,SPEED) BROWSE INCDIR(
                    -.\Device;.\App_User\Include) DEBUG OBJECTEXTEND PRINT(.\Listings\Key_Mode.lst) OBJECT(.\Objects\Key_Mode.obj)

line level    source

   1          /*******************/
   2          /*Í·ÎÄ¼þheader file*/
   3          /*******************/
   4          #include "app_main.h"
   5          
   6          /************************/
   7          /*ºê¶¨Òåmacro definition*/
   8          /************************/
   9          
  10          /*************************/
  11          /*ÀàÐÍ¶¨Òåbyte definition*/
  12          /*************************/
  13          FLAG_KEYSET_TypeDef  FlagKSet_TypeDef;//°´¼üµÄ¹¦ÄÜÉèÖÃ±êÖ¾
  14          TIME_TEMP_TypeDef    Time_Temp_TypeDef;//ÉèÖÃÊ±¼äÊ±²Å°ÑÉèÖÃµÄÊ±¼äÏÈ¸¶¸øÕâ¸ö£¬È»ºóÈ·ÈÏÁËÔÙ¸³Öµµ½gRTC_xx;
  15          
  16          /****************************/
  17          /*±êÖ¾Î»¶¨Òåflags definetion*/
  18          /****************************/
  19          
  20          /*****************************/
  21          /*±äÁ¿¶¨Òåvariable definition*/
  22          /*****************************/
  23          uint8_t  gbKeyPress;//°´¼ü°´ÏÂ
  24          uint8_t  gbKeyNone; //Ã»ÓÐ°´¼ü°´ÏÂ
  25          uint8_t  KeyValue;  //°´¼üÖµ
  26          uint8_t  KeyEvent;  //°´¼üÊÂ¼þ
  27          uint8_t  cntKeyLoop;//¼ÆÊý°´¼üÑ­»·£¬¶Ì°´£¬³¤°´£¬³¬³¤°´µÄ°´ÏÂÊ±¼ä
  28          uint8_t  cntKeylong;
  29          uint8_t  KeyCurValueBK;//ÏÖÔÚ°´¼ü±¸·Ý
  30          uint8_t  KeyCurValue;//°´¼üÏÖÔÚÖµ
  31          uint8_t  KeyLastValue;//°´¼üÉÏÒ»´ÎµÄÖµ
  32          
  33          /**************************/
  34          /*Êý×é¶¨Òåarray definition*/
  35          /**************************/
  36          
  37          /******************************/
  38          /*º¯ÊýÉùÃ÷Function declaration*/
  39          /******************************/
  40          
  41          /*****************************/
  42          /*º¯Êý¶¨Òåfunction definetion*/
  43          /*****************************/
  44          /*******************************************************************************
  45           * º¯ÊýÔ­ÐÍ£º
  46           * ÊäÈë²ÎÊý£º
  47           * Êä³ö²ÎÊý£º
  48           * º¯Êý¹¦ÄÜ£º
  49           * ·µ»ØÖµËµÃ÷£º
  50           * ´´½¨ÈÕÆÚ£º
  51           * ´´½¨ÈË£º
  52           * ÐÞ¸ÄÈÕÆÚ
  53           * ÐÞ¸ÄÈË£º
  54           * µÚN´ÎÐÞ¸Ä£º
C51 COMPILER V9.00   KEY_MODE                                                              11/24/2018 11:03:41 PAGE 2   

  55           * ÐÞ¸ÄÔ­Òò£º
  56           * ±¸×¢£º"P1=0x2F(0010_1111)"ÏÈ¸³Öµ¸øP1¿Ú£¬P15Îª1£¬P14Îª0£¬ÊäÈë¶Ë(P10-P13)Îª1£¬
  57           * È»ºóÔÙ¶ÁP1¿ÚµçÆ½(P1&0x0F)£¬²¢°Ñ¸ßËÄÎ»¶¼Çå0£¬¼ÙÈçÕâÊ±ºòP10±»°´ÏÂ£¬ÄÇ¶Áµ½µÄP1
  58           * ¿ÚµçÆ½Îª(P1&0x0f)Îª0x0E(0000_1110),È»ºóÓë0x0F(0000_1111)Òì»òµÃµ½0x01(0000_0001),
  59           * 
  60           *******************************************************************************/
  61          uint8_t  Matrix_Buttons(void)
  62          {
  63   1        uint8_t tmp1=0;       
  64   1        uint8_t tmp2=0;               
  65   1        if((P1&0x0F)!=0x0F)   
  66   1        {
  67   2         P1|=0X20;  
  68   2         P1|=0X20; 
  69   2         P1|=0X20; 
  70   2         P1|=0X20;
  71   2         tmp1=P1&0x0F;          
  72   2         P1&=~0X30; 
  73   2         P1|=0X10;  
  74   2         P1|=0X10; 
  75   2         P1|=0X10;    
  76   2         P1|=0X10; 
  77   2         tmp2=P1&0x0F;                  
  78   2        }
  79   1        P1&=~0X30;
  80   1        if((tmp1==0x0E)&&(tmp2==0x0F))
  81   1        {
  82   2              return 1; //K_SNOOZE_DIMMER
  83   2        }
  84   1        if((tmp1==0x0D)&&(tmp2==0x0F))
  85   1        {
  86   2              return 2; //K_VOLINC
  87   2        }
  88   1        if((tmp1==0x0B)&&(tmp2==0x0F))
  89   1        {
  90   2              return 3; //K_PLAY_PAUSE
  91   2        }
  92   1        if((tmp1==0x07)&&(tmp2==0x0F))
  93   1        {
  94   2              return 4; //K_NEXT
  95   2        }
  96   1        if((tmp1==0x0F)&&(tmp2==0x0E))
  97   1        {
  98   2              return 5; //K_ALARM
  99   2        }
 100   1        if((tmp1==0x0F)&&(tmp2==0x0D))
 101   1        {
 102   2              return 6; //K_VOLDEC
 103   2        }
 104   1        if((tmp1==0x0F)&&(tmp2==0x0B))
 105   1        {
 106   2              return 7; //K_BT
 107   2        }
 108   1        if((tmp1==0x0F)&&(tmp2==0x07))
 109   1        {
 110   2              return 8; //K_PREV
 111   2        }
 112   1        if((tmp1==0x0E)&&(tmp2==0x0E))
 113   1        {
 114   2              return 9; //K_AL_SNOOZE
 115   2        }
 116   1        if((tmp1==0x0D)&&(tmp2==0x0E))
C51 COMPILER V9.00   KEY_MODE                                                              11/24/2018 11:03:41 PAGE 3   

 117   1        {
 118   2              return 10; //K_AL_VOLINC
 119   2        }
 120   1        if((tmp1==0x0F)&&(tmp2==0x0C))
 121   1        {
 122   2              return 11; //K_AL_VOLDEC
 123   2        }
 124   1              return 0;   
 125   1      //      uint8_t  readData1=0;
 126   1      //      uint8_t  readData2=0;
 127   1      //      uint8_t  temp_ReakData1=0;
 128   1      //      uint8_t  temp_ReakData2=0;
 129   1      //      uint8_t  scanKeyValue;
 130   1      //      scanKeyValue=0;//Èç¹ûÃ»ÓÐ°´¼ü°´ÏÂ¾ÍÊÇ·µ»Ø0
 131   1      //       
 132   1      //      /*******************************************************************************
 133   1      //      *¹¦ÄÜ£º"P1=0x2F(0010_1111)"ÏÈ¸³Öµ¸øP1¿Ú£¬P15Îª1£¬P14Îª0£¬ÊäÈë¶Ë(P10-P13)Îª1£¬È»
 134   1      //      * ºóÔÙ¶ÁP1¿ÚµçÆ½(P1&0x0F)£¬²¢°Ñ¸ßËÄÎ»¶¼Çå0(P1&0x0F£¬¼ÙÈçÕâÊ±ºòP10±»°´ÏÂ£¬ÄÇ¶Áµ½
 135   1      //      * µÄP1¿ÚµçÆ½Îª0x0E(0000_1110),È»ºóÓë0x0F(0000_1111)Òì»òµÃµ½0x01(0000_0001),
 136   1      //      * readData1µÄ·¶Î§Îª1¡¢2¡¢4¡¢8£¬scanKeyValueµÄ·¶Î§Îª1~9,9ÊÇ×éºÏ¼ü¡£
 137   1      ////    *******************************************************************************/
 138   1      ////    P1=0x2F;                        
 139   1      ////    readData1=(P1&0x0F)^0x0F;
 140   1      //      if((P1&0x0F)!=0x0F)
 141   1      //      {
 142   1      //              readData1=P1;
 143   1      //              P1=0x2F;
 144   1      //              temp_ReakData1=(P1&0x2F)^0x0F;
 145   1      //              switch(temp_ReakData1)
 146   1      //              {
 147   1      //                      case 0x21:
 148   1      //                              scanKeyValue=1; //K_SNOOZE_DIMMER
 149   1      //                              break;
 150   1      //                      case 0x22:
 151   1      //                              scanKeyValue=2; //VOL+(Êµ¼ÊVOL-)
 152   1      //                              break;
 153   1      //                      case 0x24:
 154   1      //                              scanKeyValue=3; //K_PLAY_PAUSE
 155   1      //                              break;
 156   1      //                      case 0x28:
 157   1      //                              scanKeyValue=4; //NEXT
 158   1      //                              break;
 159   1      //                      default:
 160   1      //                              break;
 161   1      //              }
 162   1      //      }
 163   1      //      /*******************************************************************************
 164   1      //      *¹¦ÄÜ£º"P1=0x1F(0001_1111)"ÏÈ¸³Öµ¸øP1¿Ú£¬P15Îª0£¬P14Îª1£¬ÊäÈë¶Ë(P10-P13)Îª1£¬È»
 165   1      //      * ºóÔÙ¶ÁP1¿ÚµçÆ½(P1&0x0F)£¬²¢°Ñ¸ßËÄÎ»¶¼Çå0(P1&0x0F£¬¼ÙÈçÕâÊ±ºòP11±»°´ÏÂ£¬ÄÇ¶Áµ½
 166   1      //      * µÄP1¿ÚµçÆ½Îª0x0D(0000_1101),È»ºóÓë0x0F(0000_1111)Òì»òµÃµ½0x02(0000_0010),
 167   1      //      * readData2µÄ·¶Î§Îª1¡¢2¡¢4¡¢8£¬scanKeyValueµÄ·¶Î§Îª1~9£¬9ÊÇ×éºÏ¼ü¡£
 168   1      //      *******************************************************************************/
 169   1      ////    P1=0x1F;
 170   1      ////    readData2=(P1&0x0F)^0x0F;
 171   1      //      if((P1&0x0F)!=0x0F)
 172   1      //      {
 173   1      //              readData2=P1;
 174   1      //              P1=0x1F;
 175   1      //              temp_ReakData2=(P1&0x1F)^0x0F;
 176   1      //              switch(temp_ReakData2)
 177   1      //              {
 178   1      //                      case 0x11:
C51 COMPILER V9.00   KEY_MODE                                                              11/24/2018 11:03:41 PAGE 4   

 179   1      ////                            if (scanKeyValue == 1)//Îª1ËµÃ÷¸Õ²Åalarm¼ü±»°´ÏÂ£¬ÒòÎªÃ¿´Îµ÷ÓÃÕâ¸öº¯Êý¶¼»á³õÊ¼»¯
 180   1      ////                            {                                         //keyValue£¬ËùÒÔ²»»áÊÇÉÏ´Îµ÷ÓÃº¯ÊýÁôÏÂµÄÖµ
 181   1      ////                                    scanKeyValue = 9; //K_AL_SNOOZE//ALARM+SNOOZE
 182   1      ////                            }
 183   1      ////                            else if (scanKeyValue == 2)
 184   1      ////                                    scanKeyValue = 10;//K_AL_VOLINC,//ALARM+VOLINC
 185   1      ////                            else
 186   1      //                                      scanKeyValue=5; //ALARM
 187   1      //                              break;
 188   1      //                      case 0x12:
 189   1      //                              scanKeyValue=6; //VOL-
 190   1      //                              break;
 191   1      //                      case 0x14:
 192   1      //                              scanKeyValue=7; //BT
 193   1      //                              break;
 194   1      //                      case 0x18:
 195   1      //                              scanKeyValue=8; //PREV
 196   1      //                              break;
 197   1      //                      case 0x0C:
 198   1      //                              scanKeyValue = 11; //K_AL_VOLDEC,
 199   1      //                      default:
 200   1      //                              break;
 201   1      //              }
 202   1      //      }
 203   1      //      readData1=0;
 204   1      //      readData2=0;
 205   1      //      P1=0x0F;
 206   1      //      return scanKeyValue;
 207   1      }
 208          
 209          /*******************************************************************************
 210           * º¯ÊýÔ­ÐÍ£º
 211           * ÊäÈë²ÎÊý£º
 212           * Êä³ö²ÎÊý£º
 213           * º¯Êý¹¦ÄÜ£º
 214           * ·µ»ØÖµËµÃ÷£º
 215           * ´´½¨ÈÕÆÚ£º
 216           * ´´½¨ÈË£º
 217           * ÐÞ¸ÄÈÕÆÚ
 218           * ÐÞ¸ÄÈË£º
 219           * µÚN´ÎÐÞ¸Ä£º
 220           * ÐÞ¸ÄÔ­Òò£º
 221           * ±¸×¢£º
 222           *******************************************************************************/
 223          uint8_t GetKeyValue(void) 
 224          {
 225   1              uint8_t  keyNum;
 226   1              keyNum=Matrix_Buttons();
 227   1              return keyNum; //·µ»Ø°´¼ü
 228   1      }
 229          
 230          /*******************************************************************************
 231           * º¯ÊýÔ­ÐÍ£º
 232           * ÊäÈë²ÎÊý£º
 233           * Êä³ö²ÎÊý£º
 234           * º¯Êý¹¦ÄÜ£º
 235           * ·µ»ØÖµËµÃ÷£º
 236           * ´´½¨ÈÕÆÚ£º
 237           * ´´½¨ÈË£º
 238           * ÐÞ¸ÄÈÕÆÚ
 239           * ÐÞ¸ÄÈË£º
 240           * µÚN´ÎÐÞ¸Ä£º
C51 COMPILER V9.00   KEY_MODE                                                              11/24/2018 11:03:41 PAGE 5   

 241           * ÐÞ¸ÄÔ­Òò£º
 242           * ±¸×¢£º
 243           *******************************************************************************/
 244          void KeyEventPorc(uint8_t KeyTmp) //±»µ÷ÓÃÊ±½ÓÊÕµÄÊÇGetKeyValue()µÄ·µ»ØÖµ  Ò»°ã¹Ì¶¨£¬²»¸ü¸Ä
 245          {
 246   1              gbKeyPress=0;
 247   1              if(KeyCurValue!=KeyTmp) //Õâ¸öifÓï¾äÊÇÈ¥¶¶£¬»á±»Ö´ÐÐÁ½´Î£¬µÚÈý´Î½øÀ´Ê±Ö±½ÓÌø¹ý
 248   1              {//KeyTmpÎªÁÙÊ±Öµ£¬
 249   2                      if(KeyCurValueBK!=KeyTmp)
 250   2                              KeyCurValueBK=KeyTmp;
 251   2                      else //µÚ¶þ´Î½øÀ´Ê±Ö´ÐÐÕâÒ»Ìõ
 252   2                              KeyCurValue=KeyTmp; //
 253   2                      return;
 254   2              }
 255   1              if(KeyCurValue==KeyLastValue)
 256   1              {
 257   2                      if((KeyLastValue==0) || (cntKeyLoop==0))
 258   2                              return;
 259   2                      if(--cntKeyLoop==0) //Õâ¸öÔÚµÚ¶þ´Î½øKeyEventPorc()º¯Êý£¨µÚÒ»´Î½ø¡°if(KeyCurValue==KeyLastValue)¡±Ö®Ç°£©Ê
             -±±»ÏÂÃæ¸³ÖµÎª5
 260   2                      { //cntKeyLoopÎª5¾ÍÊÇ50msÊ±¼ä
 261   3                              KeyValue=KeyLastValue; //·À¶¶Ö®ºó°ÑÈ·¶¨µÄ°´¼ü¸³Öµ¸øKeyValue
 262   3                              if(gbKeyNone==0)
 263   3                                      gbKeyPress=1;
 264   3                              switch(KeyEvent)
 265   3                              {
 266   4                                      case 0:
 267   4                                              KeyEvent=1;
 268   4                                              KeyValue |= K_D;
 269   4                                              cntKeyLoop=cKEY_HOLD;
 270   4                                              break;
 271   4                                      case 1:
 272   4                                              KeyEvent=2;
 273   4                                              KeyValue |= K_H;
 274   4                                              cntKeyLoop=cKEY_RATE_VOL;
 275   4                                              break;
 276   4                                              case 2:
 277   4                                      case 3:
 278   4                                              KeyEvent=3;
 279   4                                              KeyValue |= K_R;
 280   4                                              cntKeyLoop=cKEY_RATE_VOL;
 281   4                                              if(cntKeylong<250)
 282   4                                                      cntKeylong++;
 283   4                                              break;
 284   4                              }
 285   3                      }
 286   2              }
 287   1              else
 288   1              {
 289   2                      if(KeyLastValue)
 290   2                      {
 291   3                              KeyValue=KeyLastValue;
 292   3                              if(gbKeyNone==0)
 293   3                                      gbKeyPress=1;
 294   3                              switch(KeyEvent)
 295   3                              {
 296   4                                      case 1:KeyValue |= K_U; break;
 297   4                                      case 2:KeyValue |= K_LU;break;
 298   4                                      case 3:KeyValue |= K_LU;break;
 299   4                              }
 300   3                              KeyEvent=0;
 301   3                      }
C51 COMPILER V9.00   KEY_MODE                                                              11/24/2018 11:03:41 PAGE 6   

 302   2                      else
 303   2                      {
 304   3                              gbKeyNone=0;
 305   3                              cntKeylong=0;
 306   3                      }
 307   2                      cntKeyLoop=cKEY_CLICK;
 308   2                      KeyLastValue=KeyCurValue;
 309   2              }
 310   1      }
 311          
 312          /*******************************************************************************
 313           * º¯ÊýÔ­ÐÍ£º
 314           * ÊäÈë²ÎÊý£º
 315           * Êä³ö²ÎÊý£º
 316           * º¯Êý¹¦ÄÜ£º
 317           * ·µ»ØÖµËµÃ÷£º
 318           * ´´½¨ÈÕÆÚ£º
 319           * ´´½¨ÈË£º
 320           * ÐÞ¸ÄÈÕÆÚ
 321           * ÐÞ¸ÄÈË£º
 322           * µÚN´ÎÐÞ¸Ä£º
 323           * ÐÞ¸ÄÔ­Òò£º
 324           * ±¸×¢£º
 325           *******************************************************************************/
 326          void KeyScan(void) //±»Ö÷º¯Êýµ÷ÓÃ
 327          {
 328   1              KeyEventPorc(GetKeyValue());
 329   1      }
 330           
 331           /*******************************************************************************
 332           * º¯ÊýÔ­ÐÍ£º
 333           * ÊäÈë²ÎÊý£º
 334           * Êä³ö²ÎÊý£º
 335           * º¯Êý¹¦ÄÜ£º
 336           * ·µ»ØÖµËµÃ÷£º
 337           * ´´½¨ÈÕÆÚ£º
 338           * ´´½¨ÈË£º
 339           * ÐÞ¸ÄÈÕÆÚ
 340           * ÐÞ¸ÄÈË£º
 341           * µÚN´ÎÐÞ¸Ä£º
 342           * ÐÞ¸ÄÔ­Òò£º
 343           * ±¸×¢£º2.¡¢³¤°´¡°TIME¡±¼ü2S£¬Ð¡Ê±×Ö·ûÉÁË¸£¬¶Ì°´¡°VOL-/PREV¡±¼ü£¬Ð¡Ê±µÝ¼õ£¬³¤°´
 344           * ¡°VOL-/PREV¡±¼ü£¬Ð¡Ê±¿ìËÙµÝ¼õ£»¶Ì°´¡°VOL+/NEXT¡±¼ü£¬Ð¡Ê±µÝÔö£¬³¤°´¡°VOL+/NEXT¡±¼ü£¬
 345           * Ð¡Ê±¿ìËÙµÝÔö¡£
 346           * 3¡¢¶Ì°´¡°TIME¡±¼ü£¬·Ö×Ö·ûÉÁË¸£¬¶Ì°´¡°VOL-/PREV¡±¼ü£¬·ÖÎ»ÊýµÝ¼õ£¬³¤°´¡°VOL-/PREV¡±¼ü£¬
 347           * ·ÖÎ»Êý¿ìËÙµÝ¼õ£»¶Ì°´¡°VOL+/NEXT¡±¼ü£¬·ÖÎ»ÊýµÝÔö£¬³¤°´¡°VOL+/NEXT¡±¼ü£¬·ÖÎ»Êý¿ìËÙµÝ
 348           * Ôö¡£
 349           * 4¡¢ÔÚ×ßÊ±Ä£Ê½ÏÂ£¬¶Ì°´¡°TIME/DIM¡±¼ü£¬µ÷ÕûÏÔÊ¾ÁÁ¶È£¬¿ÉÑ­»·µ÷Õû¸ß¡¢ÖÐ¡¢µÍÁÁ£¨Ä¬ÈÏ
 350           * Îª¸ßÁÁ£©
 351           *******************************************************************************/
 352          void KeyComMsg(void) 
 353          {
 354   1              if(gbKeyPress)
 355   1              { 
 356   2                      //Flag_data_bk=1;//Êý¾Ý¸Ä±äÊ±±¸·Ý
 357   2                      /**************************************************************
 358   2                      *¹¦ÄÜ£ºÈç¹ûÄÖÖÓÏìÓ¦£¬°´ÏÂ³ösnoozeµÄ°´¼ü¶¼¹Ø±ÕÄÖÖÓ
 359   2                      ***************************************************************/
 360   2                      if((Alarm1_TypeDef.Alarm_OnOff == ALARM_ON) && (Alarm1_TypeDef.Alarm_RingRun == ALARM_RING_RUN_ON))
 361   2                      {
 362   3                              
 363   3                              if((KeyValue & 0x0F) != K_SNOOZE_DIMMER)
C51 COMPILER V9.00   KEY_MODE                                                              11/24/2018 11:03:41 PAGE 7   

 364   3                              {
 365   4                                      Alarm1_PowerOFF();
 366   4                              }
 367   3                      }
 368   2                      switch(KeyValue)
 369   2                      {
 370   3                              /*******************************************************************************
 371   3                              *¹¦ÄÜ£ºÌ°Ë¯°´¼ü
 372   3                              *
 373   3                              *******************************************************************************/
 374   3                              case KU(K_SNOOZE_DIMMER)://¶Ì°´
 375   3                              {//Alarm_Ring_Run
 376   4                                      if (Alarm1_TypeDef.Alarm_RingRun == ALARM_RING_RUN_ON)
 377   4                                      {
 378   5                                              Alarm1_TypeDef.Alarm_Snooze = ALARM_SNOOZE_ON;//½øÈëÌ°Ë¯Ä£Ê½£¬Îª9·ÖÖÓ
 379   5                                              //Flag_BT_Play=0;//¶Ì°´Ö®ºó½øÈëÌ°Ë¯£¬²¢°Ñ²¥·Å±êÖ¾Çåµô£¬ÒòÎªÔÚ"Compare_1MinutePorc()"
 380   5                                                                         //ÀïÃæÓÐ¸öÅÐ¶ÏÕâ¸ö±êÖ¾Î»£¬·¢ËÍÔÝÍ£ÃüÁîµÄ
 381   5                                      }
 382   4                                      else//Õý³£×ßÊ±Ä£Ê½ÏÂ£¬¶Ì°´SNOOZE¼ü£¬µ÷½ÚLEDÆ½ÁÁ¶È£¬¿ÉÑ­»·µ÷½Ú¸ß¡¢ÖÐ¡¢µÍÁÁ¶È(Ä¬ÈÏÎª¸ß)
 383   4                                      {
 384   5                                              LED_Brightness_TypeDef--;
 385   5                                              if (LED_Brightness_TypeDef == LED_TURN_OFF)//ÈýµµÑ­»·
 386   5                                                      LED_Brightness_TypeDef = LED_HIGH;
 387   5                                      }
 388   4                                      break;
 389   4                              }
 390   3                              case KH(K_SNOOZE_DIMMER)://³¤°´
 391   3                              {
 392   4                                      
 393   4                                      break;
 394   4                              }
 395   3                              /*******************************************************************************
 396   3                              *¹¦ÄÜ£ºÒôÁ¿¼Ó
 397   3                              *
 398   3                              *******************************************************************************/
 399   3                              case KU(K_VOLINC): //¶Ì°´//ÒôÁ¿¼Ó 
 400   3                              case KR(K_VOLINC): //³¤°´//ÒôÁ¿¼Ó
 401   3                              {
 402   4                                      //³¤°´¡°VOL+¡±¼ü£¬Ð¡Ê±¿ìËÙµÝÔö¡£
 403   4                                      //³¤°´¡°VOL+¡±¼ü£¬·ÖÖÓÎ»Êý¿ìËÙµÝÔö¡£
 404   4                                      if ((FlagKSet_TypeDef == FLAG_KEYSET_SETTIME_HOUR) && (PlayMode_TypeDef == PLAY_IN_TIME))
 405   4                                      {
 406   5                                              if (Time_Temp_TypeDef.temp_RTC_Hour <= 24)
 407   5                                              {
 408   6                                                      Time_Temp_TypeDef.temp_RTC_Hour++;
 409   6                                              }
 410   5                                              else
 411   5                                              {
 412   6                                                      if (Time_Temp_TypeDef.temp_RTC_Hour > 24)
 413   6                                                      {
 414   7                                                              Time_Temp_TypeDef.temp_RTC_Hour=0;
 415   7                                                      }
 416   6                                              }
 417   5                                              timeCnt_30Sec = 0;
 418   5                                      }
 419   4                                      else if ((FlagKSet_TypeDef == FLAG_KEYSET_SETTIME_MINUTE) && (PlayMode_TypeDef == PLAY_IN_TIME))
 420   4                                      {
 421   5                                              if (Time_Temp_TypeDef.temp_RTC_Minute <= 59)
 422   5                                              {
 423   6                                                      Time_Temp_TypeDef.temp_RTC_Minute++;
 424   6                                              }
 425   5                                              else
C51 COMPILER V9.00   KEY_MODE                                                              11/24/2018 11:03:41 PAGE 8   

 426   5                                              {
 427   6                                                      if (Time_Temp_TypeDef.temp_RTC_Minute > 59)
 428   6                                                      {
 429   7                                                              Time_Temp_TypeDef.temp_RTC_Minute=0;
 430   7                                                      }
 431   6                                              }
 432   5                                              gRTC_Minute=0;
 433   5                                              timeCnt_30Sec = 0;//¿ªÆôÁË²»¶¯×÷30s×Ô¶¯±£´æ£¬ÕâÀï¶¯×÷ÁË£¬ËùÒÔÖØÐÂÖÃ0
 434   5                                      }
 435   4                                      else if ((FlagKSet_TypeDef == FLAG_KEYSET_SHORT_ALARM_HOUR) && (Alarm1_TypeDef.Alarm_OnOff == ALARM_ON
             -))
 436   4                                      {
 437   5                                              if (Alarm1_TypeDef.tempHour <= 24)
 438   5                                              {
 439   6                                                      Alarm1_TypeDef.tempHour++;
 440   6                                              }
 441   5                                              else
 442   5                                              {
 443   6                                                      if (Alarm1_TypeDef.tempHour > 24)
 444   6                                                      {
 445   7                                                              Alarm1_TypeDef.tempHour=0;
 446   7                                                      }
 447   6                                              }
 448   5                                              timeCnt_30Sec = 0;
 449   5                                      }
 450   4                                      else if ((FlagKSet_TypeDef == FLAG_KEYSET_SHORT_ALARM_MINUTE) && (Alarm1_TypeDef.Alarm_OnOff == ALARM_
             -ON))
 451   4                                      {
 452   5                                              if (Alarm1_TypeDef.tempMinute <= 59)
 453   5                                              {
 454   6                                                      Alarm1_TypeDef.tempMinute++;
 455   6                                              }
 456   5                                              else
 457   5                                              {
 458   6                                                      if (Alarm1_TypeDef.tempMinute > 59)
 459   6                                                      {
 460   7                                                              Alarm1_TypeDef.tempMinute=0;
 461   7                                                      }
 462   6                                              }
 463   5                                              timeCnt_30Sec = 0;
 464   5                                      }
 465   4                                      else if ((FlagKSet_TypeDef == FLAG_KEYSET_SHORT_ALARM_ALWORKMODE) && (Alarm1_TypeDef.Alarm_OnOff == AL
             -ARM_ON))
 466   4                                      {
 467   5                                              if (Alarm1_TypeDef.Alarm_WorkMode == ALARM_BEEP)
 468   5                                              {
 469   6                                                      Alarm1_TypeDef.Alarm_WorkMode = ALARM_BT;
 470   6                                              }
 471   5                                              else
 472   5                                              {
 473   6                                                      Alarm1_TypeDef.Alarm_WorkMode = ALARM_BEEP;
 474   6                                              }
 475   5                                              timeCnt_30Sec = 0;//¿ªÆôÁË²»¶¯×÷30s×Ô¶¯±£´æ£¬ÕâÀï¶¯×÷ÁË£¬ËùÒÔÖØÐÂÖÃ0
 476   5                                      }
 477   4                                      else//ÔÚÀ¶ÑÀ»òTF×´Ì¬ÏÂ£¬ÒôÁ¿¹¦ÄÜ
 478   4                                      {
 479   5                                              if (sysVolume < 15)
 480   5                                              {
 481   6                                                      sysVolume++;
 482   6                                              }
 483   5                                      }
 484   4                                      break;
C51 COMPILER V9.00   KEY_MODE                                                              11/24/2018 11:03:41 PAGE 9   

 485   4                              }
 486   3                              /*******************************************************************************
 487   3                              *¹¦ÄÜ£ºÔÝÍ£²¥·Å
 488   3                              *
 489   3                              *******************************************************************************/
 490   3                              case KU(K_PLAY_PAUSE): //¶Ì°´
 491   3                              {                                       
 492   4                                      /* Õâ²¿·ÖÊÇÔÚÀ¶ÑÀºÍTF¿¨Ä£Ê½ÏÂ¶Ì°´²¥·Å/ÔÝÍ£ */
 493   4      //                              if (Music_Mode_TypeDef == MUSIC_BT)//ÔÚÀ¶ÑÀÄ£Ê½
 494   4      //                              {
 495   4      //                                      if(!Flag_BT_Play)
 496   4      //                                      {
 497   4      //                                              Flag_BT_Play=1;//Èç¹ûÊÇÔÝÍ£×´Ì¬¾Í²¥·Å£¬²¢ÖÃ1
 498   4      //                                              Flag_BT_TF_Play=0;//Çå³þTF¿¨²¥·Å±êÖ¾
 499   4      //                                              bt_cmd=BT_PLAY;
 500   4      //                                      }
 501   4      //                                      else
 502   4      //                                      {
 503   4      //                                              Flag_BT_Play=0;//Èç¹ûÊÇ²¥·Å×´Ì¬¾ÍÔÝÍ££¬²¢ÖÃ0
 504   4      //                                              Flag_BT_TF_Play=0;//Çå³þTF¿¨²¥·Å±êÖ¾
 505   4      //                                              bt_cmd=BT_PAUSE;
 506   4      //                                      }
 507   4      //                              }
 508   4      //                              else if(Music_Mode_TypeDef == MUSIC_TF)//ÔÚTF¿¨Ä£Ê½
 509   4      //                              {
 510   4      //                                      if(!Flag_BT_TF_Play)
 511   4      //                                      {
 512   4      //                                              Flag_BT_TF_Play=1;//Èç¹ûÊÇÔÝÍ£×´Ì¬¾Í²¥·Å£¬²¢ÖÃ1
 513   4      //                                              Flag_BT_Play=0;
 514   4      //                                              bt_cmd=BT_PLAY;
 515   4      //                                      }
 516   4      //                                      else
 517   4      //                                      {
 518   4      //                                              Flag_BT_TF_Play=0;//Èç¹ûÊÇ²¥·Å×´Ì¬¾ÍÔÝÍ££¬²¢ÖÃ0
 519   4      //                                              Flag_BT_Play=0;
 520   4      //                                              bt_cmd=BT_PAUSE;
 521   4      //                                      }
 522   4      //                              }
 523   4                                      bt_cmd=BT_PLAY_PAUSE;
 524   4                                      break;
 525   4                              }
 526   3                              case KR(K_PLAY_PAUSE): //¼ÆÊ±
 527   3                              {
 528   4                                      if (cntKeylong == 10)//2s
 529   4                                              bt_cmd=BT_IQ;
 530   4                                      break;
 531   4                              }
 532   3                              /*******************************************************************************
 533   3                              *¹¦ÄÜ£ºÏÂÒ»Çú
 534   3                              *
 535   3                              *******************************************************************************/
 536   3                              case KU(K_NEXT): //¶Ì°´
 537   3                              {
 538   4                                      if (Music_Mode_TypeDef > MUSIC_OFF)//ÔÚÀ¶ÑÀºÍTF¿¨Ä£Ê½
 539   4                                      {
 540   5                                              bt_cmd=BT_NEXT;//ÏÂÒ»Çú
 541   5                                      }
 542   4                              }
 543   3                              case KR(K_NEXT): //³¤°´
 544   3                              {
 545   4                                      
 546   4                                      break;
C51 COMPILER V9.00   KEY_MODE                                                              11/24/2018 11:03:41 PAGE 10  

 547   4                              }
 548   3                              /*******************************************************************************
 549   3                              *¹¦ÄÜ£ºÄÖÖÓ
 550   3                              *
 551   3                              *******************************************************************************/
 552   3                              case KU(K_ALARM): //¶Ì°´//ÄÖÖÓ
 553   3                              {
 554   4                                      /* ÉèÖÃRTCÊ±¼ä ´Ó"K_AL_SNOOZE"¼üÄÄÀï¹ýÀ´µÄ*/
 555   4                                      if (FlagKSet_TypeDef == FLAG_KEYSET_SETTIME_HOUR)
 556   4                                      {
 557   5                                              /*ÔÚ³¤°´ALARM¼üºÍSNOOZE¼ü½øÈëÉèÖÃÊ±¼äÄ£Ê½-Ð¡Ê±ÉèÖÃ£¬ÔÚ¶Ì°´ALARM¼üÉèÖÃ·ÖÖÓÊ±¼ä*/
 558   5                                              SetDisplayState10s(ADJ_CLK_MIN);//ÅäÖÃÎªÉèÖÃRTCµÄ×´Ì¬-ÉÁ
 559   5                                              FlagKSet_TypeDef = FLAG_KEYSET_SETTIME_MINUTE;
 560   5                                              Time_Temp_TypeDef.Flag_Confirm_30Sec=2;//¶Ì°´ALARM¼üÈ·ÈÏÉèÖÃ»ò²»¶¯×÷30s×Ô¶¯±£´æ£¬(Îª1ÊÇÈ·
 561   5                                                                                                                         //ÈÏÄÖÖÓÉèÖÃ±êÖ¾Î»),Îª2ÊÇ30s¼ÆÊ±±êÖ¾Î»£¬
 562   5                                              timeCnt_30Sec = 0;//Ð£×¼£¬ÒÔ·ÀÒÔÇ°ÉèÖÃµÄÊ±¼ä»òÕßÆäËû¹¦ÄÜÊ¹ÓÃÊ±timeCnt_30SecÓÐ´óÓÚ0µÄÖµ
 563   5                                              break;
 564   5                                      }
 565   4                                      else if (FlagKSet_TypeDef == FLAG_KEYSET_SETTIME_MINUTE)
 566   4                                      {
 567   5                                              //ÔÚ³¤°´ALARM¼üºÍSNOOZE¼ü½øÈëÉèÖÃÊ±¼äÄ£Ê½-Ð¡Ê±ÉèÖÃ£¬ÔÚ¶Ì°´ALARM¼üÉèÖÃ·ÖÖÓÊ±¼ä
 568   5                                              //ÔÚ¶Ì°´ALRM¼üÈ·ÈÏÊ±¼äÉèÖÃ£¬»òÕßÔÚ½øÈë·ÖÖÓÉèÖÃÊ±¼äÖ®ºó²»¶¯×÷30s¼´×Ô¶¯±£´æ
 569   5                                              FlagKSet_TypeDef = FLAG_KEYSET_OFF;
 570   5                                              gRTC_Hour   = Time_Temp_TypeDef.temp_RTC_Hour;
 571   5                                              gRTC_Minute = Time_Temp_TypeDef.temp_RTC_Minute;
 572   5                                              Time_Temp_TypeDef.Flag_Confirm_30Sec = 0;//¶Ì°´ALARM¼üÈ·ÈÏÉèÖÃ
 573   5                                              timeCnt_30Sec = 0;//Ð£×¼,ÒÔ·ÀÒÔÇ°ÉèÖÃµÄÊ±¼ä»òÕßÆäËû¹¦ÄÜÊ¹ÓÃÊ±timeCnt_30SecÓÐ´óÓÚ0µÄÖµ
 574   5                                              cntDispStatus=0;
 575   5                                              Flag_DispStatus=0;
 576   5                                              break;
 577   5                                      }
 578   4      
 579   4                                      /* ÉèÖÃÄÖÖÓÊ±¼ä */
 580   4                                      if(((PlayMode_TypeDef == PLAY_IN_TIME) && (FlagKSet_TypeDef == FLAG_KEYSET_OFF)) || (Alarm1_TypeDef.Fl
             -ag_Again==1))
 581   4                                      {
 582   5                                              //Ö»ÓÐÔÚ×ßÊ±ºÍÃ»ÓÐÆäËûÉèÖÃÄ£Ê½ÏÂ(±ÈÈçÊ±¼äÉèÖÃ£¬ÒòÎª¶Ì°´ALARMÓÐÆäËû¹¦ÄÜ)£¬²Å»á½øÈë´Ëif¹¦ÄÜ
 583   5                                              //ÉèÖÃÄÔÖÐÊ±¼ä²¢¿ªÆôÄÖÖÓ
 584   5                                              Alarm1_TypeDef.tempHour   = Alarm1_TypeDef.hour;//°ÑÔ­À´ÉèÖÃµÄÄÖÖÓÊ±¼ä¸³Öµ¸øÁÙÊ±±äÁ¿ÓÃÓÚÏÔÊ¾
 585   5                                              Alarm1_TypeDef.tempMinute = Alarm1_TypeDef.minute;
 586   5                                              SetDisplayState10s(ADJ_ALARM1_HOUR);//ÄÖÖÓÐ¡Ê±ÉÁË¸
 587   5                                              FlagKSet_TypeDef = FLAG_KEYSET_SHORT_ALARM_HOUR;
 588   5                                              Alarm1_TypeDef.Alarm_OnOff = ALARM_ON;
 589   5                                              Alarm1_TypeDef.Flag_Confirm_30Sec = 2;//µÚ¶þ´Î¿ªÆôÄÖÖÓ£¬²¢ÇÒ²»ÐÞ¸ÄÄÔÖÐÊ±¼ä£¬²»¶¯×÷30s×Ô¶¯±£
 590   5                                                                                                                        //´æ£¬(Îª1ÊÇÈ·ÈÏÄÖÖÓÉèÖÃ±êÖ¾Î»)Îª2ÊÇ30s¼ÆÊ±±êÖ¾Î»£¬
 591   5                                              Alarm1_TypeDef.Flag_Again=0;//ÉèÖÃºÃÄÖÖÓºóÖØÐÂ½øÀ´£¬Èç¹û30s²»²Ù×÷¾Í»á±»ÖÃÎª1
 592   5                                      }
 593   4                                      else if ((FlagKSet_TypeDef == FLAG_KEYSET_SHORT_ALARM_HOUR) && (Alarm1_TypeDef.Alarm_OnOff == ALARM_ON
             -))  
 594   4                                      {
 595   5                                              SetDisplayState10s(ADJ_ALARM1_MIN);//ÄÖÖÓ·ÖÖÓÉÁË¸
 596   5                                              FlagKSet_TypeDef = FLAG_KEYSET_SHORT_ALARM_MINUTE;
 597   5                                              Alarm1_TypeDef.Flag_Confirm_30Sec = 2;//µÚ¶þ´Î¿ªÆôÄÖÖÓ£¬²¢ÇÒÐÞ¸ÄÄÔÖÐÊ±¼ä£¬°Ñ²»¶¯×÷×Ô¶¯±£´æ¹Ø±Õ
 598   5                                              timeCnt_30Sec = 0;                                //²¢Ð£×¼Ê±¼äÎª0
 599   5                                      }
 600   4                                      else if ((FlagKSet_TypeDef == FLAG_KEYSET_SHORT_ALARM_MINUTE) && (Alarm1_TypeDef.Alarm_OnOff == ALARM_
             -ON))
 601   4                                      {
 602   5                                              SetDisplayState10s(ADJ_ALARM1_WORK);//ÄÖÖÓ¹¤×÷Ä£Ê½ÉÁË¸£¬beepÏì»òÕßÀ¶ÑÀ±êÖ¾ÉÁ
 603   5                                              FlagKSet_TypeDef = FLAG_KEYSET_SHORT_ALARM_ALWORKMODE;
 604   5                                              //Alarm1_TypeDef.Alarm_WorkMode=ALARM_BT&ALARM_BEEP;//¹¤×÷Ä£Ê½£¬ÔÚÒôÁ¿¼ÓºÍÒôÁ¿¼õÄÇÀïÉèÖÃ
 605   5                                              Alarm1_TypeDef.Flag_Confirm_30Sec = 2;//¶Ì°´ALARM¼üÈ·ÈÏÉèÖÃ»ò²»¶¯×÷30s×Ô¶¯±£´æ£¬(Îª1
C51 COMPILER V9.00   KEY_MODE                                                              11/24/2018 11:03:41 PAGE 11  

 606   5                                                                                                                        //ÊÇÈ·ÈÏÄÖÖÓÉèÖÃ±êÖ¾Î»)Îª2ÊÇ30s¼ÆÊ±±êÖ¾Î»£¬
 607   5                                              timeCnt_30Sec = 0;//Ð£×¼£¬ÒÔ·ÀÒÔÇ°ÉèÖÃµÄÊ±¼ä»òÕßÆäËû¹¦ÄÜÊ¹ÓÃÊ±timeCnt_30SecÓÐ´óÓÚ0µÄÖµ
 608   5                                      }
 609   4                                      else if ((FlagKSet_TypeDef == FLAG_KEYSET_SHORT_ALARM_ALWORKMODE) && (Alarm1_TypeDef.Alarm_OnOff == AL
             -ARM_ON))
 610   4                                      {
 611   5                                              //FlagKSet_TypeDef = FLAG_KEYSET_SHORT_ALARM_CONFIRMSET;
 612   5                                              FlagKSet_TypeDef = FLAG_KEYSET_OFF;
 613   5                                              Alarm1_TypeDef.Flag_Confirm_30Sec = 0;//¶Ì°´ALARM¼üÈ·ÈÏÉèÖÃ»ò²»¶¯×÷30s×Ô¶¯±£´æ£¬(Îª1
 614   5                                                                                                                        //ÊÇÈ·ÈÏÄÖÖÓÉèÖÃ±êÖ¾Î»)Îª2ÊÇ30s¼ÆÊ±±êÖ¾Î»£¬
 615   5                                              timeCnt_30Sec = 0;//Ð£×¼£¬ÒÔ·ÀÒÔÇ°ÉèÖÃµÄÊ±¼ä»òÕßÆäËû¹¦ÄÜÊ¹ÓÃÊ±timeCnt_30SecÓÐ´óÓÚ0µÄÖµ
 616   5                                              Alarm1_TypeDef.hour   = Alarm1_TypeDef.tempHour;//¶Ì°´ALARM¼üÈ·ÈÏÉèÖÃ
 617   5                                              Alarm1_TypeDef.minute = Alarm1_TypeDef.tempMinute;
 618   5                                              Alarm1_TypeDef.Flag_Again=1;
 619   5                                              cntDispStatus=0;
 620   5                                              Flag_DispStatus=0;
 621   5                                      }
 622   4      
 623   4                                      break;
 624   4                              }
 625   3                              case KH(K_ALARM): //³¤°´//ÄÖÖÓ
 626   3                              {
 627   4                                      
 628   4                                      break;
 629   4                              }
 630   3                              /*******************************************************************************
 631   3                              *¹¦ÄÜ£ºÒôÁ¿¼õ
 632   3                              *
 633   3                              *******************************************************************************/
 634   3                              case KU(K_VOLDEC): //¶Ì°´//ÒôÁ¿¼õ
 635   3                              case KR(K_VOLDEC): //³¤°´//ÒôÁ¿¼õ
 636   3                              {
 637   4                                      //³¤°´¡°VOL-¡±¼ü£¬Ð¡Ê±¿ìËÙµÝ¼õ£»
 638   4                                      //³¤°´¡°VOL-¡±¼ü£¬·ÖÖÓÎ»Êý¿ìËÙµÝ¼õ£»
 639   4                                      if ((FlagKSet_TypeDef == FLAG_KEYSET_SETTIME_HOUR) && (PlayMode_TypeDef == PLAY_IN_TIME))
 640   4                                      {
 641   5                                              if (Time_Temp_TypeDef.temp_RTC_Hour > 0)
 642   5                                              {
 643   6                                                      Time_Temp_TypeDef.temp_RTC_Hour--;
 644   6                                              }
 645   5                                              else //ÐÎ³ÉÑ­»·
 646   5                                              {
 647   6                                                      if (Time_Temp_TypeDef.temp_RTC_Hour == 0)
 648   6                                                              Time_Temp_TypeDef.temp_RTC_Hour=24;
 649   6                                              }
 650   5                                              timeCnt_30Sec = 0;
 651   5                                      }
 652   4                                      else if ((FlagKSet_TypeDef == FLAG_KEYSET_SETTIME_MINUTE) && (PlayMode_TypeDef == PLAY_IN_TIME))
 653   4                                      {
 654   5                                              if (Time_Temp_TypeDef.temp_RTC_Minute > 0)
 655   5                                              {
 656   6                                                      Time_Temp_TypeDef.temp_RTC_Minute--;
 657   6                                              }
 658   5                                              else//ÐÎ³ÉÑ­»·
 659   5                                              {
 660   6                                                      if (Time_Temp_TypeDef.temp_RTC_Minute == 0)
 661   6                                                      {
 662   7                                                              Time_Temp_TypeDef.temp_RTC_Minute=59;
 663   7                                                      }
 664   6                                              }
 665   5                                              gRTC_Minute=0;
 666   5                                              timeCnt_30Sec = 0;//¿ªÆôÁË²»¶¯×÷30s×Ô¶¯±£´æ£¬ÕâÀï¶¯×÷ÁË£¬ËùÒÔÖØÐÂÖÃ0
C51 COMPILER V9.00   KEY_MODE                                                              11/24/2018 11:03:41 PAGE 12  

 667   5                                      }
 668   4                                      else if ((FlagKSet_TypeDef == FLAG_KEYSET_SHORT_ALARM_HOUR) && (Alarm1_TypeDef.Alarm_OnOff == ALARM_ON
             -))
 669   4                                      {
 670   5                                              if (Alarm1_TypeDef.tempHour > 0)
 671   5                                              {
 672   6                                                      Alarm1_TypeDef.tempHour--;
 673   6                                              }
 674   5                                              else//ÐÎ³ÉÑ­»·
 675   5                                              {
 676   6                                                      if (Alarm1_TypeDef.tempHour == 0)
 677   6                                                      {
 678   7                                                              Alarm1_TypeDef.tempHour=24;
 679   7                                                      }
 680   6                                              }
 681   5                                              timeCnt_30Sec = 0;//¿ªÆôÁË²»¶¯×÷30s×Ô¶¯±£´æ£¬ÕâÀï¶¯×÷ÁË£¬ËùÒÔÖØÐÂÖÃ0
 682   5                                      }
 683   4                                      else if ((FlagKSet_TypeDef == FLAG_KEYSET_SHORT_ALARM_MINUTE) && (Alarm1_TypeDef.Alarm_OnOff == ALARM_
             -ON))
 684   4                                      {
 685   5                                              if (Alarm1_TypeDef.tempMinute > 0)
 686   5                                              {
 687   6                                                      Alarm1_TypeDef.tempMinute--;
 688   6                                              }
 689   5                                              else//ÐÎ³ÉÑ­»·
 690   5                                              {
 691   6                                                      if (Alarm1_TypeDef.tempMinute == 0)
 692   6                                                      {
 693   7                                                              Alarm1_TypeDef.tempMinute=59;
 694   7                                                      }
 695   6                                              }
 696   5                                              timeCnt_30Sec = 0;
 697   5                                      }
 698   4                                      else if ((FlagKSet_TypeDef == FLAG_KEYSET_SHORT_ALARM_ALWORKMODE) && (Alarm1_TypeDef.Alarm_OnOff == AL
             -ARM_ON))
 699   4                                      {
 700   5                                              if (Alarm1_TypeDef.Alarm_WorkMode == ALARM_BEEP)
 701   5                                              {
 702   6                                                      Alarm1_TypeDef.Alarm_WorkMode = ALARM_BT;
 703   6                                              }
 704   5                                              else
 705   5                                              {
 706   6                                                      Alarm1_TypeDef.Alarm_WorkMode = ALARM_BEEP;
 707   6                                              }
 708   5                                              timeCnt_30Sec = 0;//¿ªÆôÁË²»¶¯×÷30s×Ô¶¯±£´æ£¬ÕâÀï¶¯×÷ÁË£¬ËùÒÔÖØÐÂÖÃ0
 709   5                                      }
 710   4                                      else//ÔÚÀ¶ÑÀ»òTF×´Ì¬ÏÂ£¬ÒôÁ¿¹¦ÄÜ
 711   4                                      {
 712   5                                              if (sysVolume > 0)
 713   5                                              {
 714   6                                                      sysVolume--;
 715   6                                              }
 716   5                                      }
 717   4      
 718   4                                      break;
 719   4                              }
 720   3                              /*******************************************************************************
 721   3                              *¹¦ÄÜ£ºÀ¶ÑÀ
 722   3                              *
 723   3                              *******************************************************************************/
 724   3                              case KU(K_BT): //¶Ì°´
 725   3                              {
C51 COMPILER V9.00   KEY_MODE                                                              11/24/2018 11:03:41 PAGE 13  

 726   4                                      //¶Ì°´¡°VOL-/PREV¡±¼ü£¬Ð¡Ê±µÝ¼õ£¬
 727   4                                      //¶Ì°´¡°VOL-/PREV¡±¼ü£¬·ÖÖÓÎ»ÊýµÝ¼õ£¬
 728   4                                      if (Music_Mode_TypeDef == MUSIC_OFF)
 729   4                                      {
 730   5                                              Music_Mode_TypeDef = MUSIC_BT;//Èç¹ûÒÑ¾­²åÈëTF¿¨£¬ÔÚTF_Check()ÀïÃæÒ²»áÁ¢Âí×ªÎªTF¿¨Ä£Ê½
 731   5                                      }
 732   4                                      else
 733   4                                      {
 734   5                                              Music_Mode_TypeDef = MUSIC_OFF;
 735   5                                      }
 736   4                                      break;
 737   4                              }
 738   3                              case KR(K_BT): //³¤°´
 739   3                              {
 740   4                                      if (cntKeylong == 10)//2s
 741   4                                              bt_cmd=BT_PAIR;
 742   4                                      break;
 743   4                              }
 744   3                              /*******************************************************************************
 745   3                              *¹¦ÄÜ£ºÉÏÒ»Çú
 746   3                              *
 747   3                              *******************************************************************************/
 748   3                              case KU(K_PREV): //¶Ì°´
 749   3                              {
 750   4                                      if (Music_Mode_TypeDef > MUSIC_OFF)//ÔÚÀ¶ÑÀºÍTF¿¨Ä£Ê½
 751   4                                      {
 752   5                                              bt_cmd=BT_PREV;//ÉÏÒ»Çú
 753   5                                      }
 754   4                              }
 755   3                              case KR(K_PREV): //³¤°´
 756   3                              {
 757   4                                      
 758   4                                      break;
 759   4                              }
 760   3                              /*******************************************************************************
 761   3                              *¹¦ÄÜ£ºÉèÖÃRTCÊ±¼ä     ×éºÏ¼ü=ÄÖÖÓ+Ì°Ë¯
 762   3                              *
 763   3                              *******************************************************************************/
 764   3                              case KU(K_AL_SNOOZE): //¶Ì°´
 765   3                              {
 766   4      
 767   4                                      break;
 768   4                              }
 769   3                              case KR(K_AL_SNOOZE): //³¤°´
 770   3                              {
 771   4                                      if (PlayMode_TypeDef == PLAY_IN_TIME)
 772   4                                      {
 773   5                                              if (cntKeylong == 10)//2s
 774   5                                              {
 775   6                                                      //³¤°´ALARMºÍSNOOZE¼ü2s½øÈëÊ±¼äÉèÖÃÄ£Ê½-Ð¡Ê±ÉèÖÃ
 776   6                                                      Time_Temp_TypeDef.temp_RTC_Hour   = gRTC_Hour;
 777   6                                                      Time_Temp_TypeDef.temp_RTC_Minute = gRTC_Minute;
 778   6                                                      SetDisplayState10s(ADJ_CLK_HOUR);//ÅäÖÃÎªÉèÖÃRTCµÄ×´Ì¬-ÉÁ
 779   6                                                      FlagKSet_TypeDef = FLAG_KEYSET_SETTIME_HOUR;
 780   6                                                      Time_Temp_TypeDef.Flag_Confirm_30Sec=2;//¶Ì°´ALARM¼üÈ·ÈÏÉèÖÃ»ò²»¶¯×÷30s×Ô¶¯±£´æ£¬(Îª1ÊÇÈ·
 781   6                                                                                                                         //ÈÏÄÖÖÓÉèÖÃ±êÖ¾Î»),Îª2ÊÇ30s¼ÆÊ±±êÖ¾Î»£¬
 782   6                                                      timeCnt_30Sec = 0;//Ð£×¼£¬ÒÔ·ÀÒÔÇ°ÉèÖÃµÄÊ±¼ä»òÕßÆäËû¹¦ÄÜÊ¹ÓÃÊ±timeCnt_30SecÓÐ´óÓÚ0µÄÖµ
 783   6                                              }
 784   5                                      }
 785   4                                      break;
 786   4                              }
 787   3                              /*******************************************************************************
C51 COMPILER V9.00   KEY_MODE                                                              11/24/2018 11:03:41 PAGE 14  

 788   3                              *¹¦ÄÜ£ºÔö¼ÓÒ»Ð¡Ê±ÏÄÁîÊ±      ×éºÏ¼ü=ÄÖÖÓ+ÒôÁ¿¼Ó
 789   3                              *
 790   3                              *******************************************************************************/
 791   3                              case KU(K_AL_VOLINC): //¶Ì°´
 792   3                              case KR(K_AL_VOLINC): //³¤°´
 793   3                              {
 794   4                                      if (PlayMode_TypeDef == PLAY_IN_TIME)
 795   4                                      {
 796   5                                              if(Flag_DaylightSaving != 1)//Ö»½øÀ´1´Î£¬³ý·Ç¼õÁËÏÄÁîÊ±
 797   5                                              {
 798   6                                                      if (cntKeylong == 10)//2s
 799   6                                                      {
 800   7                                                              gRTC_Hour = gRTC_Hour + 1;//×éºÏ¼ü-ÄÖÖÓºÍÒôÁ¿¼Ó-Í¬Ê±2s-RTCÊ±¼ä¼ÓÒ»Ð¡Ê±£¬±íÊ¾¿ªÆôÏÄÁîÊ±
 801   7                                                              Flag_DaylightSaving=1;
 802   7                                                      }
 803   6                                              }
 804   5                                      }
 805   4                                      break;
 806   4                              }
 807   3                              /*******************************************************************************
 808   3                              *¹¦ÄÜ£º¼õÉÙÒ»Ð¡Ê±ÏÄÁîÊ±      ×éºÏ¼ü=ÄÖÖÓ+ÒôÁ¿¼õ
 809   3                              *
 810   3                              *******************************************************************************/
 811   3                              case KU(K_AL_VOLDEC): //¶Ì°´
 812   3                              case KR(K_AL_VOLDEC): //³¤°´
 813   3                              {
 814   4                                      if (PlayMode_TypeDef == PLAY_IN_TIME)
 815   4                                      {
 816   5                                              if(Flag_DaylightSaving != 2)//Ö½½íÀ´Ò»´Î£¬³ý·Ç¼ÓÁËÏÄÁîÊ±
 817   5                                              {
 818   6                                                      if (cntKeylong == 10)//2s
 819   6                                                      {
 820   7                                                              gRTC_Hour = gRTC_Hour - 1;//×éºÏ¼ü-ÄÖÖÓºÍÒôÁ¿¼Ó-Í¬Ê±2s-RTCÊ±¼ä¼ÓÒ»Ð¡Ê±£¬±íÊ¾¿ªÆôÏÄÁîÊ±
 821   7                                                              Flag_DaylightSaving=2;
 822   7                                                      }
 823   6                                              }
 824   5                                      }
 825   4                                      break;
 826   4                              }
 827   3                      }
 828   2              }
 829   1      }
 830          
 831          
 832          
 833          
 834           
 835           /*******************************************************************************
 836           * º¯ÊýÔ­ÐÍ£º
 837           * ÊäÈë²ÎÊý£º
 838           * Êä³ö²ÎÊý£º
 839           * º¯Êý¹¦ÄÜ£º
 840           * ·µ»ØÖµËµÃ÷£º
 841           * ´´½¨ÈÕÆÚ£º
 842           * ´´½¨ÈË£º
 843           * ÐÞ¸ÄÈÕÆÚ
 844           * ÐÞ¸ÄÈË£º
 845           * µÚN´ÎÐÞ¸Ä£º
 846           * ÐÞ¸ÄÔ­Òò£º
 847           * ±¸×¢£º
 848           *******************************************************************************/
 849           
C51 COMPILER V9.00   KEY_MODE                                                              11/24/2018 11:03:41 PAGE 15  

 850           
 851           /*******************************************************************************
 852           * º¯ÊýÔ­ÐÍ£º
 853           * ÊäÈë²ÎÊý£º
 854           * Êä³ö²ÎÊý£º
 855           * º¯Êý¹¦ÄÜ£º
 856           * ·µ»ØÖµËµÃ÷£º
 857           * ´´½¨ÈÕÆÚ£º
 858           * ´´½¨ÈË£º
 859           * ÐÞ¸ÄÈÕÆÚ
 860           * ÐÞ¸ÄÈË£º
 861           * µÚN´ÎÐÞ¸Ä£º
 862           * ÐÞ¸ÄÔ­Òò£º
 863           * ±¸×¢£º
 864           *******************************************************************************/
 865          
 866          
 867          
 868          
 869          
 870          
 871          
 872          
 873          
 874          
 875          
 876          
 877          
 878          
 879          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1095    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     14    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
